<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>stated-js</title><meta name="description" content="Documentation for stated-js"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">stated-js</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>stated-js</h2></div><div class="tsd-panel tsd-typography"><a id="md:stated" class="tsd-anchor"></a><h1><a href="#md:stated">Stated</a></h1><!-- TOC -->
<ul>
<li><a href="#md:stated">Stated</a></li>
<li><a href="#md:licensing-and-documentation">Licensing and documentation</a></li>
<li><a href="#md:api-docs">API docs</a></li>
<li><a href="#md:testing">Testing</a></li>
<li><a href="#md:intro">Intro</a></li>
<li><a href="#md:motivation">Motivation</a></li>
<li><a href="#md:getting-started">Getting Started</a><ul>
<li><a href="#md:installation">Installation</a></li>
<li><a href="#md:running">Running</a><ul>
<li><a href="#md:repl-mode">REPL Mode</a></li>
<li><a href="#md:oneshot-mode">Oneshot mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#md:stated-js-lib">stated-js lib</a><ul>
<li><a href="#md:api-documentation">API documentation</a></li>
<li><a href="#md:basic-usage">Basic usage</a><ul>
<li><a href="#md:stated-js-packagejson-exports">Stated-js package.json exports</a></li>
<li><a href="#md:nodejs-based-projects">Node.js based projects</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#md:repl-commands">REPL Commands</a><ul>
<li><a href="#md:open">.open</a></li>
<li><a href="#md:all-commands">All commands</a></li>
<li><a href="#md:out">.out</a></li>
<li><a href="#md:color">.color</a></li>
<li><a href="#md:log">.log</a></li>
<li><a href="#md:set-">.set</a></li>
<li><a href="#md:repl-command-arguments">REPL command arguments</a><ul>
<li><a href="#md:--options">--options</a><ul>
<li><a href="#md:strict">strict</a></li>
</ul>
</li>
<li><a href="#md:--xf">--xf</a></li>
<li><a href="#md:--ctx">--ctx</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#md:language--syntax">Language &amp; Syntax</a><ul>
<li><a href="#md:expressions-and-variables">Expressions and Variables</a></li>
<li><a href="#md:dollars-moustache">Dollars-Moustache</a></li>
<li><a href="#md:dollars-variables">Dollars-Variables</a></li>
<li><a href="#md:temporary-expressions">Temporary Expressions</a></li>
<li><a href="#md:references">References</a></li>
<li><a href="#md:expression-scope">Expression Scope</a></li>
<li><a href="#md:rerooting-expressions">Rerooting Expressions</a></li>
<li><a href="#md:tags">Tags</a></li>
</ul>
</li>
<li><a href="#md:generative-templates">Generative Templates</a></li>
<li><a href="#md:reactive-behavior">Reactive Behavior</a><ul>
<li><a href="#md:svg-command">SVG command</a></li>
<li><a href="#md:yaml">YAML</a></li>
<li><a href="#md:setting-values-in-the-stated-repl">Setting Values in the stated REPL</a></li>
<li><a href="#md:expression-scope-1">Expression Scope</a></li>
<li><a href="#md:rerooting-expressions-1">Rerooting Expressions</a></li>
<li><a href="#md:dag">DAG</a></li>
<li><a href="#md:visualizing-the-plan-with-svg-command">visualizing the plan with .svg command</a></li>
</ul>
</li>
<li><a href="#md:concurrency">Concurrency</a><ul>
<li><a href="#md:serialized-mutations">Serialized Mutations</a></li>
<li><a href="#md:atomic-state-updates">Atomic State Updates</a></li>
<li><a href="#md:multi-version-concurrency-control-mvcc-and-forked">Multi Version Concurrency Control (MVCC) and  $forked</a></li>
</ul>
</li>
<li><a href="#md:yaml-1">YAML</a></li>
<li><a href="#md:complex-data-processing">Complex Data Processing</a></li>
<li><a href="#md:functions">Functions</a><ul>
<li><a href="#md:jsonata-built-in">JSONata built-in</a></li>
<li><a href="#md:stated-functions">Stated functions</a><ul>
<li><a href="#md:timeout">$timeout</a></li>
<li><a href="#md:interval">$interval</a></li>
<li><a href="#md:fetch">$fetch</a></li>
<li><a href="#md:import">$import</a><ul>
<li><a href="#md:importing-bits-of-other-templates">Importing bits of other templates</a></li>
<li><a href="#md:setting-up-local-imports-with---importpath">Setting up local imports with --importPath</a></li>
<li><a href="#md:import-javascript-es-modules">Import Javascript ES modules</a></li>
<li><a href="#md:the-__init-sidecar-function">The __init sidecar function</a></li>
</ul>
</li>
<li><a href="#md:open-1">$open</a></li>
<li><a href="#md:set">$set</a></li>
<li><a href="#md:debounce">$debounce</a></li>
<li><a href="#md:defer">$defer</a></li>
<li><a href="#md:ratelimit">$rateLimit</a></li>
</ul>
</li>
<li><a href="#md:custom-functions">Custom Functions</a><ul>
<li><a href="#md:simple-custom-function-example">Simple Custom Function Example</a></li>
<li><a href="#md:more-complex-function-example">More Complex Function Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#md:error-handling">Error Handling</a><ul>
<li><a href="#md:the-error-object">The error object</a></li>
<li><a href="#md:error-reporting">Error Reporting</a></li>
<li><a href="#md:errorreport-function">$errorReport function</a></li>
</ul>
</li>
<li><a href="#md:templateprocessor-snapshots">TemplateProcessor Snapshots</a></li>
<li><a href="#md:understanding-plans">Understanding Plans</a></li>
<li><a href="#md:planning">Planning</a><ul>
<li><a href="#md:metainfo-graph">MetaInfo Graph</a></li>
<li><a href="#md:dfs-tree-traversal">DFS Tree Traversal</a><!-- TOC --></li>
</ul>
</li>
</ul>
<a id="md:licensing-and-documentation" class="tsd-anchor"></a><h1><a href="#md:licensing-and-documentation">Licensing and documentation</a></h1><p>Stated is a cisco-open, Apache 2 Licensed, Open Source project at <a href="https://github.com/cisco-open/stated">https://github.com/cisco-open/stated</a>, our github 
main page. </p>
<a id="md:api-docs" class="tsd-anchor"></a><h1><a href="#md:api-docs">API docs</a></h1><p>If you would like to see a table of contents and developer API docs, jump over to our API docs page which is
generated in CI and <a href="https://cisco-open.github.io/stated/index.html">published here</a>. Most developers will need to 
interact with the TemplateProcessor. It&#39;s <a href="https://cisco-open.github.io/stated/classes/TemplateProcessor.default.html">API Docs are here</a></p>
<a id="md:testing" class="tsd-anchor"></a><h1><a href="#md:testing">Testing</a></h1><p>Are the examples in this README 
correct/reliable? Every markdown codeblock in this readme is 
<a href="https://github.com/cisco-open/stated/blob/main/README.test.js">tested on every commit</a>.</p>
<p><img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/stated.svg" alt="stated logo"></p>
<a id="md:intro" class="tsd-anchor"></a><h1><a href="#md:intro">Intro</a></h1><p>Stated is an engine of reactive state (a State Daemon). State is expressed as JSON or YAML. Rules for evolving state are
written via embedded <a href="http://docs.jsonata.org/">JSONata</a> expressions in classic shell variable syntax <code>${}</code>. </p>
<pre><code class="language-shell"><span class="hl-0">cat</span><span class="hl-1"> </span><span class="hl-2">examples/hello.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;to&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;world&quot;,</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${&#39;hello &#39; &amp; </span><span class="hl-3">to</span><span class="hl-2">}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>You can use stated as a &#39;one shot&#39; template processor that computes all bound states once. If we run the template above
through stated, we see the <code>${}</code> expression has been evaluated:</p>
<pre><code class="language-shell"><span class="hl-0">stated</span><span class="hl-1"> </span><span class="hl-2">example/hello.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;to&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;world&quot;,</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;hello world&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Variables can be passed in:</p>
<pre><code class="language-shell"><span class="hl-0">cat</span><span class="hl-1"> </span><span class="hl-2">example/helloVar.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${&#39;hello &#39; &amp; </span><span class="hl-3">$TO</span><span class="hl-2">}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-0">stated</span><span class="hl-1"> </span><span class="hl-2">example/helloVar.json</span><span class="hl-1"> </span><span class="hl-4">--ctx.TO=world</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;hello world&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The more interesting use of Stated is an engine of reactive state. Load a template in the REPL, <code>.set</code> a value
and watch the state evolve.</p>
<pre><code class="language-json"><span class="hl-1">stated</span><br/><span class="hl-1">&gt; .init -f example/hello.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;world&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;msg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;hello &#39; &amp; to}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .set /to </span><span class="hl-2">&quot;Joshua&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;msg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello Joshua&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .set /to </span><span class="hl-2">&quot;David Lightman&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;David Lightman&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;msg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello David Lightman&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Stated templates can contain expressions, reusable functions, and can even use JS timeouts and intervals. Let&#39;s see
a template that increments a counter every 10 ms, forever, as long it is running in the Stated
engine. We will use the <code>--tail</code> command to tail the <code>count</code> variable until it reaches 100, then 
automatically disconnect the tail.</p>
<pre><code class="language-json"><span class="hl-1">cat example/infiniteCount.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $setInterval(function(){$set(&#39;/count&#39;, count+1)}, 10) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">}</span><br/><span class="hl-1">stated</span><br/><span class="hl-1">&gt; .init -f example/infiniteCount.json --tail </span><span class="hl-2">&quot;/count until $=100&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-6">100</span>
</code><button>Copy</button></pre>
<p>Stated is written in JS, and runs in the browser and in Node. Stated&#39;s REPL extends the Node.js REPL and allows you to 
interact with running templates. Stated uses asynchronous event loop I/O and can be used to orchestrate complex workflows:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/homeworlds.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;lukePersonUrl&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(&#39;https://swapi.tech/api/people/?name=luke&#39;).json().**.url}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;lukePersonDetails&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(lukePersonUrl).json().result[0]}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;lukeHomeworldURL&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ lukePersonDetails.**.homeworld }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;homeworldDetails&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(lukeHomeworldURL).json() }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;homeworldName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ homeworldDetails.**.name }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out /homeworldName</span><br/><span class="hl-2">&quot;Tatooine&quot;</span>
</code><button>Copy</button></pre>
<p>Unlike an ordinary program, Stated templates can be kept &quot;alive&quot; indefinitely. A change to any of the independent fields
causes change propagation throughout the DAG. Stated includes a node REPL, <code>stated.ts</code>, for testing Stated json templates, and a JS library for embedding stated
in applications. A typical REPL session consists of loading a template with the <code>init</code> command, viewing the computed
output with the <code>.out</code> command and then setting values with the <code>.set</code> command and observing the changed output.</p>
<pre><code class="language-json"><span class="hl-1">falken$ stated</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex08.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${c}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${d+1+e}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${b+1}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${e+1}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;e&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-6">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;e&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .set /e </span><span class="hl-6">42</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">87</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">86</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-6">87</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-6">43</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;e&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Stated templates are modular and can be imported from a URL:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex18.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ norad.commanderDetails  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $import(&#39;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/norad.json&#39;)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:motivation" class="tsd-anchor"></a><h1><a href="#md:motivation">Motivation</a></h1><p>Consider this ordinary program:</p>
<pre><code class="language-js"><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">a</span><span class="hl-1">=</span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">b</span><span class="hl-1">=</span><span class="hl-3">a</span><span class="hl-1">;</span><br/><span class="hl-3">a</span><span class="hl-1">=</span><span class="hl-6">42</span><span class="hl-1">;</span><br/><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-3">b</span><span class="hl-1">); </span><span class="hl-7">//prints out 1</span>
</code><button>Copy</button></pre>
<p>In an ordinary sequential program the value of <code>b</code> is not affected by changes to the value of <code>a</code>
at any point after the value of <code>b</code> has been assigned. But there are many situations where we 
do NOT want a sequential program execution Instead, we actually want <code>b</code> to change when <code>a</code> changes. Broadly, these cases fall under the rubric
of &quot;reactive&quot; or &quot;state driven&quot; applications. When we try to build reactive applications
upon a sequential execution model we are forced to code the data flow graph ourselves and things become
very complex quickly. How could we make <code>b</code> change any time <code>a</code> changes in a sequential world? Perhaps naively like this?</p>
<pre><code class="language-js"><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">a</span><span class="hl-1">=</span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">b</span><span class="hl-1">=</span><span class="hl-3">a</span><span class="hl-1">;</span><br/><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-0">setA</span><span class="hl-1">(</span><span class="hl-3">val</span><span class="hl-1">){</span><br/><span class="hl-1">    </span><span class="hl-3">a</span><span class="hl-1">=</span><span class="hl-3">val</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">b</span><span class="hl-1">=</span><span class="hl-3">a</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>...or perhaps more generally like this:</p>
<pre><code class="language-js"><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">data</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-3">a:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">b:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1"> </span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">handler</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">set</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1">(</span><span class="hl-3">target</span><span class="hl-1">, </span><span class="hl-3">property</span><span class="hl-1">, </span><span class="hl-3">value</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-3">property</span><span class="hl-1"> === </span><span class="hl-2">&#39;a&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">target</span><span class="hl-1">.</span><span class="hl-3">b</span><span class="hl-1"> = </span><span class="hl-3">value</span><span class="hl-1">; </span><span class="hl-7">// When &#39;a&#39; changes, also change &#39;b&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">target</span><span class="hl-1">[</span><span class="hl-3">property</span><span class="hl-1">] = </span><span class="hl-3">value</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1">; </span><span class="hl-7">// The set operation was successful</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">proxy</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Proxy</span><span class="hl-1">(</span><span class="hl-3">data</span><span class="hl-1">, </span><span class="hl-3">handler</span><span class="hl-1">);</span><br/><br/><span class="hl-3">proxy</span><span class="hl-1">.</span><span class="hl-3">a</span><span class="hl-1"> = </span><span class="hl-6">2</span><span class="hl-1">; </span><span class="hl-7">// Setting a new value for &#39;a&#39;</span><br/><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-3">proxy</span><span class="hl-1">.</span><span class="hl-3">a</span><span class="hl-1">); </span><span class="hl-7">// Outputs: 2</span><br/><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-3">proxy</span><span class="hl-1">.</span><span class="hl-3">b</span><span class="hl-1">); </span><span class="hl-7">// Outputs: 2</span>
</code><button>Copy</button></pre>
<p>Every &quot;coding&quot; approach requires us to understand and implement code for propagating data dependencies. Stated solves
for this by natively parsing and understanding dependencies.</p>
<pre><code class="language-json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;a&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p><code>b$</code> is now declared to be continuously dependent upon <code>a</code> and reactive to any changes in <code>a</code>. This greatly
simplifies the development of systems that <em>are</em> naturally reactive or dependency heavy, such as:</p>
<ul>
<li>dynamic/continuous reactive UI state</li>
<li>lambda-like computations</li>
<li>workflows</li>
<li>configuration file</li>
</ul>
<a id="md:getting-started" class="tsd-anchor"></a><h1><a href="#md:getting-started">Getting Started</a></h1><a id="md:installation" class="tsd-anchor"></a><h2><a href="#md:installation">Installation</a></h2><p>To install the <code>stated-js</code> package, you can use yarn or npm. Open your terminal and run one of the following commands:</p>
<p>Using Yarn:</p>
<pre><code class="language-shell"><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">global</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">stated-js</span>
</code><button>Copy</button></pre>
<p>Using Npm:</p>
<pre><code class="language-shell"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-4">-g</span><span class="hl-1"> </span><span class="hl-2">stated-js</span>
</code><button>Copy</button></pre>
<a id="md:running" class="tsd-anchor"></a><h2><a href="#md:running">Running</a></h2><a id="md:repl-mode" class="tsd-anchor"></a><h3><a href="#md:repl-mode">REPL Mode</a></h3><p>To use the Stated REPL (Read-Eval-Print Loop) it is recommended to have at least version 19.2 or higher of node.js. The 
Stated REPL is built on <a href="https://nodejs.org/api/repl.html#repl">Node REPL</a>. 
You can start the REPL by running the <code>stated</code> command in your terminal:</p>
<pre><code class="language-shell"><span class="hl-0">stated</span>
</code><button>Copy</button></pre>
<p>The REPL will launch, allowing you to interact with the stated-js library. For example you can enter this command in the
REPL:</p>
<pre><code class="language-bash"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex01.json&quot;</span>
</code><button>Copy</button></pre>
<a id="md:oneshot-mode" class="tsd-anchor"></a><h3><a href="#md:oneshot-mode">Oneshot mode</a></h3><p>in oneshot mode, stated.ts simply computes the output template and exits. This is useful when you do not intend to 
change any if the fields after the initial output render</p>
<pre><code class="language-bash"><span class="hl-0">falken$</span><span class="hl-1"> </span><span class="hl-2">stated</span><span class="hl-1"> </span><span class="hl-2">example/ex01.json</span><br/><span class="hl-1">{</span><br/><span class="hl-0">&quot;to&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;world&quot;,</span><br/><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;hello world&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:stated-js-lib" class="tsd-anchor"></a><h1><a href="#md:stated-js-lib">stated-js lib</a></h1><a id="md:api-documentation" class="tsd-anchor"></a><h2><a href="#md:api-documentation">API documentation</a></h2><p>API documentation is generated in CI and published to the project github page at <a href="https://cisco-open.github.io/stated/">https://cisco-open.github.io/stated/</a></p>
<a id="md:basic-usage" class="tsd-anchor"></a><h2><a href="#md:basic-usage">Basic usage</a></h2><p>Much more detailed progammer usage can be found by perusing <a href="https://cisco-open.github.io/stated/classes/TemplateProcessor.default.html">https://cisco-open.github.io/stated/classes/TemplateProcessor.default.html</a>
To use the stated-js library in your own projects, you can require it as a dependency.
Here&#39;s an example of how you can import it into your JavaScript file:</p>
<pre><code class="language-js"><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-3">TemplateProcessor</span><span class="hl-1"> </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-2">&#39;stated-js&#39;</span><br/><br/><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-0">tryIt</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">tp</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">TemplateProcessor</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;a&quot;</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-2">&quot;aaa&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;b&quot;</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${a}&quot;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">tp</span><span class="hl-1">.</span><span class="hl-0">initialize</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">tp</span><span class="hl-1">.</span><span class="hl-0">setData</span><span class="hl-1">(</span><span class="hl-2">&quot;/a&quot;</span><span class="hl-1">, </span><span class="hl-6">42</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-3">tp</span><span class="hl-1">.</span><span class="hl-3">output</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-7">// console will print...</span><br/><span class="hl-1">    </span><span class="hl-7">//    {</span><br/><span class="hl-1">    </span><span class="hl-7">//        &quot;a&quot;: 42,</span><br/><span class="hl-1">    </span><span class="hl-7">//        &quot;b&quot;: 42</span><br/><span class="hl-1">    </span><span class="hl-7">//    }     </span><br/><span class="hl-1">}</span><br/><span class="hl-0">tryIt</span><span class="hl-1">().</span><span class="hl-0">catch</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1"> </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-3">err</span><span class="hl-1">));</span>
</code><button>Copy</button></pre>
<a id="md:stated-js-packagejson-exports" class="tsd-anchor"></a><h4><a href="#md:stated-js-packagejson-exports">Stated-js package.json exports</a></h4><p>The distribution of stated-js exports two different webpacks, one for ES Module (ie &quot;import&quot;) which is in <code>./dist/bundle.mjs</code>,
and one for Common JS (ie &quot;require&quot;) which is in <code>./dist/bundle-common-js.cjs</code>. Using <code>import</code> or <code>require</code> in your JS
code from a project with a package.json will automatically choose the correct dist target. Both the ES and Common JS
exports are designed for use in the browser. Here is an excerpt of package.json showing exactly what is exported.</p>
<pre><code class="language-json"><span class="hl-2">&quot;exports&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;.&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;import&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;./dist/bundle.mjs&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;require&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;./dist/bundle-common-js.cjs&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;./dist/src/TemplateProcessor.js&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;./dist/src/TemplateProcessor.js&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;./dist/src/CliCore.js&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;./dist/src/CliCore.js&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;./dist/src/StatedREPL.js&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;./dist/src/StatedREPL.js&quot;</span><br/><span class="hl-1">  }</span>
</code><button>Copy</button></pre>
<a id="md:nodejs-based-projects" class="tsd-anchor"></a><h4><a href="#md:nodejs-based-projects">Node.js based projects</a></h4><p>If you are building for a Node.js environment you should not use the webpacked exports for <code>import</code> or <code>require</code>. 
Instead, use the &#39;raw&#39; <code>TemplateProcessor.js</code>, <code>CliCore.js</code>, and <code>StatedREPL.js</code>. Write your import statement like this
for Node.js :</p>
<pre><code class="language-js"><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-3">TemplateProcessor</span><span class="hl-1"> </span><span class="hl-8">from</span><span class="hl-1"> </span><span class="hl-2">&#39;stated-js/dist/src/TemplateProcessor.js&#39;</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>When you run Node.js, you must pass <code>--experimental-vm-modules</code> flag to the Node.js runtime. This is due to the 
fact that stated-js is written using ES Module syntax.</p>
<a id="md:repl-commands" class="tsd-anchor"></a><h1><a href="#md:repl-commands">REPL Commands</a></h1><p>REPL commands can be used once you start the REPL by running <code>stated</code> from your prompt. All examples in this
doc assume your working directory is the stated git repo&#39;s root folder.</p>
<a id="md:open" class="tsd-anchor"></a><h2><a href="#md:open">.open</a></h2><p>Stated provides a set of REPL commands to interact with the system. The <code>.open</code> command is the easiest way to get started
opening an example template:</p>
<img width="1000" src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdnl6NDgzdnE0bWlwbzU0NjBlOTNtMmE0OHJ1NjRpdmJxYTdtb3FleiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/0kmQtLaWvuthTU1f2o/giphy.gif"/>

<a id="md:all-commands" class="tsd-anchor"></a><h2><a href="#md:all-commands">All commands</a></h2><table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
<th>flags &amp; args</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td><code>.open</code></td>
<td>Interactive command to open a template (defaults to examples folder)</td>
<td></td>
<td><code>.open</code></td>
</tr>
<tr>
<td><code>.cd</code></td>
<td>Change directory (then use .open command)</td>
<td></td>
<td><code>.cd ..</code></td>
</tr>
<tr>
<td><code>.init</code></td>
<td>Initialize the template from a JSON file.</td>
<td>&bull; <code>-f &lt;path&gt;</code> <br> &bull; <code>--tags=&lt;taglist&gt;</code><br>&bull;<code>--options=&lt;json&gt;</code> <br> &bull; <code>--xf=&lt;path&gt;</code><br> &bull; <code>--importPath=&lt;path&gt;</code> <br> &bull; <code>--tail &quot;&lt;tailargs&gt;&quot; --ctx.&lt;dotted-path&gt;=val</code></td>
<td><code>.init -f &quot;example/hello.json&quot; --tags=FOO,BAR --xf=~/falken/myEnv.json --options={&quot;strict&quot;:{&quot;refs&quot;:true}} --importPath=~/falken/mytemplates --tail &quot;/ until msg=&#39;hello world&#39;&quot; --ctx.TO=world</code></td>
</tr>
<tr>
<td><code>.set</code></td>
<td>Set data to a JSON pointer path.</td>
<td><code>&lt;path&gt; &lt;data&gt;</code></td>
<td><code>.set /to &quot;jsonata&quot;</code></td>
</tr>
<tr>
<td><code>.from</code></td>
<td>Show the dependents of a given JSON pointer.</td>
<td><code>&lt;path&gt;</code></td>
<td><code>.from /a</code></td>
</tr>
<tr>
<td><code>.to</code></td>
<td>Show the dependencies of a given JSON pointer.</td>
<td><code>&lt;path&gt;</code></td>
<td><code>.to /b</code></td>
</tr>
<tr>
<td><code>.in</code></td>
<td>Show the input template.</td>
<td><code>None</code></td>
<td><code>.in</code></td>
</tr>
<tr>
<td><code>.out</code></td>
<td>Show the current state of the template.</td>
<td><code>[&lt;jsonPtr&gt;]</code></td>
<td><code>.out</code> <br><code>.out /data/accounts</code></td>
</tr>
<tr>
<td><code>.state</code></td>
<td>Show the current state of the template metadata.</td>
<td><code>None</code></td>
<td><code>.state</code></td>
</tr>
<tr>
<td><code>.plan</code></td>
<td>Show the execution plan for rendering the template.</td>
<td><code>None</code></td>
<td><code>.plan</code></td>
</tr>
<tr>
<td><code>.note</code></td>
<td>Show a separator line with a comment in the REPL output.</td>
<td><code>&lt;comment&gt;</code></td>
<td><code>.note &quot;Example 8&quot;</code></td>
</tr>
<tr>
<td><code>.log</code></td>
<td>Set the logging level</td>
<td><code>[silent, error, warn, info, verbose, debug]</code></td>
<td><code>.log silent</code></td>
</tr>
<tr>
<td><code>.color</code></td>
<td>Enable Colors</td>
<td><code>[on,off]</code></td>
<td><code>.color on</code></td>
</tr>
<tr>
<td><code>.tail</code></td>
<td>Tail part of the document for changes</td>
<td><code>&lt;jsonPointer&gt; (until &lt;jsonata_expr&gt;)?</code></td>
<td><code>.tail /</code> <br> <code>.tail &quot;/ until foo=&#39;bar&#39;&quot;</code></td>
</tr>
<tr>
<td><code>.svg</code></td>
<td>Serve an SVG diagram of the DAG</td>
<td><code>--port &lt;portnumber&gt;</code> (defaults to 4242)</td>
<td><code>.svg --port 3000</code></td>
</tr>
<tr>
<td><code>.restore</code></td>
<td>Restore from a snapshot</td>
<td>&bull; <code>-f &lt;path&gt;</code> <br> &bull; <code>--tags=&lt;taglist&gt;</code><br>&bull; <code>--xf=&lt;path&gt;</code><br> &bull; <code>--importPath=&lt;path&gt;</code> <br> &bull; <code>--tail &quot;&lt;tailargs&gt;&quot;</code></td>
<td><code>.restore -f &quot;example/restoreSnapshot.json&quot; --tail &quot;/count until $=10&quot;</code></td>
</tr>
</tbody></table>
<a id="md:out" class="tsd-anchor"></a><h2><a href="#md:out">.out</a></h2><p>The stated repl lets you experiment with templates. The simplest thing to do in the REPL is load a json file. The REPL
parses the input, builds an execution plan, and executes the result. To see the result you have to use the <code>.out</code></p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex09.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${ $[0] + $[1] }&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:color" class="tsd-anchor"></a><h2><a href="#md:color">.color</a></h2><p>You can set terminal colors for enhanced readability from a terminal</p>
<pre><code class="language-json"><span class="hl-1">&gt; .note color does not appear in this markdown file</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .color on</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex01.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;the answer is: &#39;&amp; b}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:log" class="tsd-anchor"></a><h2><a href="#md:log">.log</a></h2><p>the <code>.log</code> command can set the log level to <code>[silent, error, warn, info, verbose, debug]</code>. Enabling high
log levels like debug can help you track down problems with expressions.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .log debug</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;log level&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;debug&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-shell"><span class="hl-1"> </span><span class="hl-0">.init</span><span class="hl-1"> </span><span class="hl-4">-f</span><span class="hl-1"> </span><span class="hl-2">&quot;example/errors.json&quot;</span><br/><span class="hl-0">arguments:</span><span class="hl-1"> </span><span class="hl-2">{&quot;_&quot;:[],&quot;f&quot;:&quot;example/errors.json&quot;,&quot;filepath&quot;:&quot;example/errors.json&quot;,&quot;tags&quot;:[],&quot;oneshot&quot;:</span><span class="hl-4">false</span><span class="hl-2">,&quot;options&quot;:{}}</span><br/><span class="hl-0">verbose:</span><span class="hl-1"> </span><span class="hl-2">initializing...</span><br/><span class="hl-0">debug:</span><span class="hl-1"> </span><span class="hl-2">tags:</span><span class="hl-1"> </span><span class="hl-2">{}</span><br/><span class="hl-0">verbose:</span><span class="hl-1"> </span><span class="hl-2">evaluating</span><span class="hl-1"> </span><span class="hl-2">template...</span><br/><span class="hl-0">error:</span><span class="hl-1"> </span><span class="hl-2">Error</span><span class="hl-1"> </span><span class="hl-2">evaluating</span><span class="hl-1"> </span><span class="hl-2">expression</span><span class="hl-1"> </span><span class="hl-2">at</span><span class="hl-1"> </span><span class="hl-2">/b</span><br/><span class="hl-0">error:</span><span class="hl-1"> </span><span class="hl-2">The</span><span class="hl-1"> </span><span class="hl-2">right</span><span class="hl-1"> </span><span class="hl-2">side</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-2">the</span><span class="hl-1"> </span><span class="hl-2">&quot;+&quot;</span><span class="hl-1"> </span><span class="hl-2">operator</span><span class="hl-1"> </span><span class="hl-2">must</span><span class="hl-1"> </span><span class="hl-2">evaluate</span><span class="hl-1"> </span><span class="hl-2">to</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> </span><span class="hl-2">number</span><span class="hl-1"> </span><span class="hl-2">{&quot;code&quot;:&quot;T2002&quot;,&quot;position&quot;:3,&quot;stack&quot;:&quot;Error\n    at evaluateNumericExpression (/Users/ghendrey/proj/jsonataexperiments/node_modules/jsonata/jsonata.js:4122:25)\n    at evaluateBinary (/Users/ghendrey/proj/jsonataexperiments/node_modules/jsonata/jsonata.js:3900:30)\n    at async evaluate (/Users/ghendrey/proj/jsonataexperiments/node_modules/jsonata/jsonata.js:3490:26)\n    at async Object.evaluate (/Users/ghendrey/proj/jsonataexperiments/node_modules/jsonata/jsonata.js:5558:26)\n    at async TemplateProcessor._evaluateExprNode (file:///Users/ghendrey/proj/jsonataexperiments/src/TemplateProcessor.ts:637:25)\n    at async TemplateProcessor._evaluateExpression (file:///Users/ghendrey/proj/jsonataexperiments/src/TemplateProcessor.ts:556:28)\n    at async TemplateProcessor.evaluateJsonPointersInOrder (file:///Users/ghendrey/proj/jsonataexperiments/src/TemplateProcessor.ts:515:31)\n    at async TemplateProcessor.evaluateDependencies (file:///Users/ghendrey/proj/jsonataexperiments/src/TemplateProcessor.ts:358:16)\n    at async TemplateProcessor.evaluate (file:///Users/ghendrey/proj/jsonataexperiments/src/TemplateProcessor.ts:123:9)\n    at async TemplateProcessor.initialize (file:///Users/ghendrey/proj/jsonataexperiments/src/TemplateProcessor.ts:113:9)&quot;,&quot;token&quot;:&quot;+&quot;,&quot;value&quot;:&quot; is not a string&quot;}</span><br/><span class="hl-0">debug:</span><span class="hl-1"> </span><span class="hl-2">Expression:</span><span class="hl-1"> </span><span class="hl-2">a</span><span class="hl-1"> </span><span class="hl-2">+</span><span class="hl-1"> </span><span class="hl-2">&#39; is not a string&#39;</span><br/><span class="hl-0">debug:</span><span class="hl-1"> </span><span class="hl-2">Target:</span><span class="hl-1"> </span><span class="hl-2">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;a&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-6">42</span><span class="hl-2">,</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;b&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${</span><span class="hl-3">a</span><span class="hl-2"> + &#39; is not a string&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-0">debug:</span><span class="hl-1"> </span><span class="hl-2">Result:</span><span class="hl-1"> </span><span class="hl-2">null</span><br/><span class="hl-0">verbose:</span><span class="hl-1"> </span><span class="hl-2">_evaluateExpression</span><span class="hl-1"> </span><span class="hl-2">at</span><span class="hl-1"> </span><span class="hl-2">/b</span><span class="hl-1"> </span><span class="hl-2">completed</span><span class="hl-1"> </span><span class="hl-2">in</span><span class="hl-1"> </span><span class="hl-6">13</span><span class="hl-1"> </span><span class="hl-2">ms.</span><br/><span class="hl-0">verbose:</span><span class="hl-1"> </span><span class="hl-2">evaluation</span><span class="hl-1"> </span><span class="hl-2">complete</span><span class="hl-1"> </span><span class="hl-2">in</span><span class="hl-1"> </span><span class="hl-6">13</span><span class="hl-1"> </span><span class="hl-2">ms...</span><br/><span class="hl-0">verbose:</span><span class="hl-1"> </span><span class="hl-2">initialization</span><span class="hl-1"> </span><span class="hl-2">complete...</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;a&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-6">42</span><span class="hl-2">,</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;b&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${</span><span class="hl-3">a</span><span class="hl-2"> + &#39; is not a string&#39;}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:set" class="tsd-anchor"></a><h2><a href="#md:set">.set</a></h2><p>The stated REPL also allows you to dynamically set values in your templates, further aiding in debugging and development.
In the example below <code>.set /a/0 100</code> sets a[0] to 100. The syntax of <code>/a/0</code> is <a href="https://datatracker.ietf.org/doc/html/rfc6901">RFC-6901 JSON Pointer</a>.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex09.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${ $[0] + $[1] }&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .set /a/</span><span class="hl-6">0</span><span class="hl-1"> </span><span class="hl-6">100</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">100</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">101</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:repl-command-arguments" class="tsd-anchor"></a><h2><a href="#md:repl-command-arguments">REPL command arguments</a></h2><a id="md:--options" class="tsd-anchor"></a><h3><a href="#md:--options">--options</a></h3><p>The cli and REPL both support <code>--options</code> which can be provided as arguments to other commands
Options can also be used in oneshot mode. Note the use of backslashes to escape quotes in the JSON on the CLI</p>
<pre><code class="language-shell"><span class="hl-0">falken$</span><span class="hl-1"> </span><span class="hl-2">stated</span><span class="hl-1"> </span><span class="hl-4">--options=</span><span class="hl-1">{</span><span class="hl-0">\</span><span class="hl-0">&quot;strict</span><span class="hl-10">\&quot;</span><span class="hl-0">:{</span><span class="hl-10">\&quot;</span><span class="hl-0">refs</span><span class="hl-10">\&quot;</span><span class="hl-0">:true}} example/strictref.json</span><br/><span class="hl-0">error: /z does not exist, referenced from /c (strict.refs option enabled)</span><br/><span class="hl-0">{</span><br/><span class="hl-0">  a: 42,</span><br/><span class="hl-0">  b: 42,</span><br/><span class="hl-0">  c: {</span><br/><span class="hl-0">    error: {</span><br/><span class="hl-0">      name: &#39;strict.refs&#39;,</span><br/><span class="hl-0">      message: &#39;/z does not exist, referenced from /c (strict.refs option enabled)&#39;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code><button>Copy</button></pre>
<a id="md:strict" class="tsd-anchor"></a><h4><a href="#md:strict">strict</a></h4><p>The <code>strict</code> option currently supports the <code>refs</code> property. Setting <code>{&quot;strict&quot;:{&quot;refs&quot;:true}}</code> will cause templates
to throw an Exception when references in the template cannot be resolved. Reference checking is only performed against
the template itself; it is not performed agains variables that are injected into the execution context by the TemplateProcessor
library.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .log silent</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;log level&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;silent&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/strictref.json&quot;</span><span class="hl-1"> --options={</span><span class="hl-5">&quot;strict&quot;</span><span class="hl-1">:{</span><span class="hl-5">&quot;refs&quot;</span><span class="hl-1">:</span><span class="hl-4">true</span><span class="hl-1">}}</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${z}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;strict.refs&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/z does not exist, referenced from /c (strict.refs option enabled)&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:--xf" class="tsd-anchor"></a><h3><a href="#md:--xf">--xf</a></h3><p>The <code>--xf</code> argument can be used to provide a context file. Context is used
to provide <a href="https://docs.jsonata.org/embedding-extending#expressionevaluateinput-bindings-callback">JSONata Bindings</a></p>
<pre><code class="language-shell"><span class="hl-1">&gt; .note here is a regular json file</span><br/><span class="hl-0">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/env.json&quot;</span><span class="hl-1"> </span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;env&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">{</span><br/><span class="hl-1">    </span><span class="hl-0">&quot;name&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;Dr. Stephen Falken&quot;,</span><br/><span class="hl-1">    </span><span class="hl-0">&quot;addr&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;Goose Island, OR, USA&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; </span><span class="hl-0">.note</span><span class="hl-1"> </span><span class="hl-2">let&#39;s use it as context to a stated template</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-2">&gt; .init -f &quot;example/useEnv.json&quot; --xf=example/env.json</span><br/><span class="hl-2">{</span><br/><span class="hl-2">  &quot;name&quot;: &quot;${$env.name}&quot;,</span><br/><span class="hl-2">  &quot;address&quot;: &quot;${$env.addr}&quot;</span><br/><span class="hl-2">}</span><br/><span class="hl-2">&gt; .out</span><br/><span class="hl-2">{</span><br/><span class="hl-2">  &quot;name&quot;: &quot;Dr. Stephen Falken&quot;,</span><br/><span class="hl-2">  &quot;address&quot;: &quot;Goose Island, OR, USA&quot;</span><br/><span class="hl-2">}</span>
</code><button>Copy</button></pre>
<a id="md:--ctx" class="tsd-anchor"></a><h3><a href="#md:--ctx">--ctx</a></h3><p>The <code>--ctx</code> argument can be used to inject context variables into the template. Variables with a sinle <code>$</code> like <code>$foo</code>
refer to the JSONata Context. You can inject variables into the context using <code>--ctx.&lt;dot-path&gt;=val</code>.</p>
<pre><code class="language-shell"><span class="hl-1">&gt; .init -f example/ctx.json --ctx.name david --ctx.games.choice1=chess --ctx.games.choice2 </span><span class="hl-2">&quot;global thermonuclear war&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${&#39;Hello, &#39; &amp; </span><span class="hl-3">$name</span><span class="hl-2"> &amp; &#39;, how about a nice game of &#39; &amp; </span><span class="hl-3">$games</span><span class="hl-2">.</span><span class="hl-3">choice1</span><span class="hl-2">}&quot;,</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;games&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${</span><span class="hl-3">$games</span><span class="hl-2">}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;msg&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello, david, how about a nice game of chess&quot;,</span><br/><span class="hl-1">  </span><span class="hl-0">&quot;games&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">{</span><br/><span class="hl-1">    </span><span class="hl-0">&quot;choice1&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;chess&quot;,</span><br/><span class="hl-1">    </span><span class="hl-0">&quot;choice2&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-2">&quot;global thermonuclear war&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:language-amp-syntax" class="tsd-anchor"></a><h1><a href="#md:language-amp-syntax">Language &amp; Syntax</a></h1><a id="md:expressions-and-variables" class="tsd-anchor"></a><h2><a href="#md:expressions-and-variables">Expressions and Variables</a></h2><p>What makes a Stated template different from an ordinary JSON file? JSONata Expressions of course! Stated analyzes the 
Abstract Syntax Tree of every JSONata expression in the file, and learns what <em>references</em> are made by each expression
to other fields of the document. The <em>references</em> of an expression become the <em>dependencies</em> of the field, which are 
used to build a DAG. The DAG allows Stated to know what expressions to compute if any fields of the document change. 
Fields of the document are changed either via the REPL <code>.set</code> function, or by calling the equivalent library function.
Many classes of <em>reactive</em> application need to maintain state, and need to propagate state changes through the <em>dependees</em>
of a particular field (a <em>dependee</em> of foo is a field that <em>depends</em> on foo). Stated can be used as state store for
reactive applications.</p>
<a id="md:dollars-moustache" class="tsd-anchor"></a><h2><a href="#md:dollars-moustache">Dollars-Moustache</a></h2><p>returning to our <code>example/hello.json</code>, the <code>msg</code> field is a simple example of a dollars-moustache. 
Stated allows JSONata <em>expressions</em> to be embedded in a JSON document using <code>${&lt;...JSONata here...&gt;}</code> syntax. The <code>${}</code>
tells stated that a field such as <code>msg</code> is not an ordinary string field, but rather a JSONata expression that has to be 
evaluated in order to <em>compute</em> the value of the field.</p>
<pre><code class="language-json"><span class="hl-1">falken$ cat example/hello.json</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;world&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;msg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;hello &#39; &amp; to}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:dollars-variables" class="tsd-anchor"></a><h2><a href="#md:dollars-variables">Dollars-Variables</a></h2><p>There is also a more concise alternative to <code>${}</code>. The field can simply be named with a trailing
dollars sign.</p>
<pre><code class="language-json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;world&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;msg$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;&#39;hello &#39; &amp; to&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>However the <code>foo$</code> style can only be used when the expression is being assigned to a field. It won&#39;t work for array 
elements like this, where there is no field name. For array elements the <code>${}</code> must be used:</p>
<pre><code class="language-json"><span class="hl-1">[</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-2">&quot;${$[0]+$[1]}&quot;</span><span class="hl-1">]</span>
</code><button>Copy</button></pre>
<a id="md:temporary-expressions" class="tsd-anchor"></a><h2><a href="#md:temporary-expressions">Temporary Expressions</a></h2><p>The <code>!</code> symbol is used mark fields as temporary. The <code>!</code> can be used both as a prefix to the expression, and as a suffix
to a key. Temporary fields are removed from the output. 
Notice how /b and /c! are removed from the output. Also notice that when an expression like <code>${`c!`.c1}</code> refers to <code>c!</code> 
that backtics must be used.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/tempVars.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;!${a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;c!&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c1&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${a + 1}&quot;</span><br/><span class="hl-1">   },</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${`c!`.c1}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-6">43</span><br/><span class="hl-1">}</span><br/><br/>
</code><button>Copy</button></pre>
<a id="md:references" class="tsd-anchor"></a><h2><a href="#md:references">References</a></h2><p>The most important thing stated does is analyze your embedded jsonata programs to understand their <em>references</em>. This 
means that as the user you don&#39;t have to <em>tell</em> stated what an expression depends on, and 
consequently you don&#39;t have to instruct Stated on how it should react to changes. It <em>knows</em>. In the example below, a JSONata <a href="https://docs.jsonata.org/programming"><em>block</em></a> is used to produce <code>defcon$</code>. It 
defines local variables like <code>$tmp</code> which are pure JSONata constructs. The JSONata program also references fields 
of the input like <code>MAX_DEFCON</code> and <code>threatLevel</code>. States understands that if <code>threatLevel changes</code>, 
<code>defcon$</code> must be recalculated.  As shown below after viewing the output with the <code>.out</code> commnand, we 
mutate the <code>threatLevel</code> field which results in <code>defcon$</code> changing from 3 to 5.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex20.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;defcon$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;($tmp:=$floor(intelLevel * threatLevel);$tmp:= $tmp&lt;=MAX_DEFCON?$tmp:MAX_DEFCON;$tmp&gt;=MIN_DEFCON?$tmp:MIN_DEFCON)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;MAX_DEFCON&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;MIN_DEFCON&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;intelLevel&quot;</span><span class="hl-1">: </span><span class="hl-6">1.45</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;threatLevel&quot;</span><span class="hl-1">: </span><span class="hl-6">2.2</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;defcon$&quot;</span><span class="hl-1">: </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;MAX_DEFCON&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;MIN_DEFCON&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;intelLevel&quot;</span><span class="hl-1">: </span><span class="hl-6">1.45</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;threatLevel&quot;</span><span class="hl-1">: </span><span class="hl-6">2.2</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .set /threatLevel </span><span class="hl-6">3.5</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;defcon$&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;MAX_DEFCON&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;MIN_DEFCON&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;intelLevel&quot;</span><span class="hl-1">: </span><span class="hl-6">1.45</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;threatLevel&quot;</span><span class="hl-1">: </span><span class="hl-6">3.5</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:expression-scope" class="tsd-anchor"></a><h2><a href="#md:expression-scope">Expression Scope</a></h2><p>Individual JSONata programs are embedded in JSON files between <code>${..}</code>. What is the input to the JSONata program?
The input, by default, is the object or array that the expression resides in. For instance in the example <strong>above</strong>, you can see that the JSONata <code>$</code> variable refers to the array itself. Therefore, expressions like <code>$[0]</code>
refer to the first element of the array.</p>
<a id="md:rerooting-expressions" class="tsd-anchor"></a><h2><a href="#md:rerooting-expressions">Rerooting Expressions</a></h2><p>In Stated templates, one way to declare a JSONata expression is by surrounding it by &quot;dollars moustaches&quot;.
E.g <code>${...some expression...}</code>. JSONata expressions always have a <a href="https://docs.jsonata.org/programming#built-in-variables">context</a>.
The <code>$</code> variable always points to the current context. The <code>$$</code> variable always points to the input (root context) for an
expression.
In a Stated template, the root context for an expression is the object in which the expression is contained. For
Example:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/context.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${[c,&#39; and &#39;,$.c,&#39; and &#39;,$$.c,&#39; are the same thing. $ (current context) is /a, the object in which this expression resides&#39;]~&gt;$join}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello and hello and hello are the same thing. $ (current context) is /a, the object in which this expression resides&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Now we will show how we can change the context of an expression using &#39;rerooting.&#39; Rerooting allows the expression&#39;s root
context to be pointed anywhere in the json document.
In the example below, consider <code>greeting &amp; &#39;, &#39; &amp;  player1&#39;</code>. We want <code>player1</code> to refer to the content at json pointer <code>/player1</code> (the field named &#39;player1&#39; at the root of the document).
But our expression <code>greeting &amp; &#39;, &#39; &amp;  player1</code> is located deep in the document at <code>/dialog/partI</code>. So how can we cause
the root of the document to be the context for the JSONata expression <code>greeting &amp; &#39;, &#39; &amp;  player1</code>?
You can reroot an expression in a different part of the document using relative rooting <code>../${&lt;expr&gt;}</code> syntax or you can root an
at the absolute doc root with <code>/${&lt;expr&gt;}</code>. The example below shows how expressions located below the root object, can
explicitly set their context using the rooting syntax. Both absolute rooting, <code>/${...}</code> and relative rooting <code>../${...}</code>
are shown.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex04.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player1&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player2&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Professor Falken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;dialog&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;../../${greeting &amp; &#39;, &#39; &amp;  player1}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;../../${greeting &amp; &#39;, &#39; &amp;  player2}&quot;</span><br/><span class="hl-1">     ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg3&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${player1 &amp; &#39;, would you like to play a game?&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg4&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${&#39;Certainly, &#39;&amp; player2 &amp; &#39;. How about a nice game of chess?&#39;}&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player1&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player2&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Professor Falken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;dialog&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Hello, Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Hello, Professor Falken&quot;</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg3&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua, would you like to play a game?&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg4&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Certainly, Professor Falken. How about a nice game of chess?&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>An advanced rerooting operator is the <code>//</code> absolute root operator. The <code>/</code> rooting operator, that we showed above,  will never allow the expression
to &#39;escape&#39; outside of the template it was defined in. But what if we intend for a template to be imported into another template
and we expect there to be a variable defined in the other template that we should use? This is where the <code>//</code> absolute root
operator can be used. The <code>//</code> operator will set the expression context to the absolute root of whatever the final document is
after all imports have been performed.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/absoluteRoot.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;!${&#39;Professor Falken&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;//${&#39;Hello, &#39; &amp; to}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello, Professor Falken&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/importsAbsoluteRoot.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$import(&#39;example/absoluteRoot.json&#39;)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello, Joshua&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:tags" class="tsd-anchor"></a><h2><a href="#md:tags">Tags</a></h2><p>JSONata &quot;dollars moustache&quot; expressions can be <em>tagged</em> with <code>@tag</code> syntax. In the example below our template
declares tags WAR and PEACE. Expressions with a tag will only be executed when the corresponding tag is
provided in the <code>--tags</code> flag. When tags are provided with <code>--tags</code> untagged expressions will be ignored. 
Tags such as <code>@WAR</code> and <code>@PEACE</code> are automatically propagated transitively to all dependent expressions. 
Therefore, in the example below only <code>peace</code> requires the <code>@PEACE</code> tag, which is transitively applies to 
<code>peaceMsg</code> and <code>warAndPeaceMsg</code>. In large templates this is extrememly desirable to as it alleviates the 
developer of having to maintain the tag by continually checking that any expressions that depend on a tagged 
expression are also tagged.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex23.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peace&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@PEACE ${&#39;DEFCON 1&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;war&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@WAR ${&#39;DEFCON 5&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;war is &#39; &amp; war}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;Peace is &#39; &amp; peace}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warAndPeaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [warMsg,peaceMsg]~&gt;$join(&#39; &#39;) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;untaggedExpr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;A strange game. The only winning move is not to play.&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peace&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@PEACE ${&#39;DEFCON 1&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;war&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@WAR ${&#39;DEFCON 5&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;war is &#39; &amp; war}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;Peace is &#39; &amp; peace}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warAndPeaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [warMsg,peaceMsg]~&gt;$join(&#39; &#39;) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;untaggedExpr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;A strange game. The only winning move is not to play.&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex23.json&quot;</span><span class="hl-1"> --tags=PEACE</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peace&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@PEACE ${&#39;DEFCON 1&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;war&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@WAR ${&#39;DEFCON 5&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;war is &#39; &amp; war}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;Peace is &#39; &amp; peace}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warAndPeaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [warMsg,peaceMsg]~&gt;$join(&#39; &#39;) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;untaggedExpr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;A strange game. The only winning move is not to play.&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peace&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;DEFCON 1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;war&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@WAR ${&#39;DEFCON 5&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;war is &#39; &amp; war}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;peaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Peace is DEFCON 1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;warAndPeaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [warMsg,peaceMsg]~&gt;$join(&#39; &#39;) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;untaggedExpr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;A strange game. The only winning move is not to play.&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex23.json&quot;</span><span class="hl-1"> --tags=PEACE,WAR</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;peace&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@PEACE ${&#39;DEFCON 1&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;war&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;@WAR ${&#39;DEFCON 5&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;warMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;war is &#39; &amp; war}&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;peaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;Peace is &#39; &amp; peace}&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;warAndPeaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [warMsg,peaceMsg]~&gt;$join(&#39; &#39;) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;untaggedExpr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;A strange game. The only winning move is not to play.&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;peace&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;DEFCON 1&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;war&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;DEFCON 5&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;warMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;war is DEFCON 5&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;peaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Peace is DEFCON 1&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;warAndPeaceMsg&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;war is DEFCON 5 Peace is DEFCON 1&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;untaggedExpr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;A strange game. The only winning move is not to play.&#39;}&quot;</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:blocked-properties-with-" class="tsd-anchor"></a><h2><a href="#md:blocked-properties-with-">Blocked Properties with </a></h2><p>Properties whose names start with &quot;&quot; are completely ignored during template processing. This is useful for:</p>
<ol>
<li>Adding notes or comments that should not be evaluated</li>
<li>Temporarily disabling parts of a template</li>
<li>Keeping sensitive or debug information in the template but preventing its evaluation</li>
</ol>
<p>When a property name starts with &quot;&quot;, the MetaInfoProducer will skip that property and all of its children, effectively making them invisible to the template processor.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex25.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;should not be evaluated: &#39;) &amp; a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${a}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;should not be evaluated: &#39;) &amp; a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex26.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;Will NOT be evaluated: &#39;) &amp; a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;Will be evaluated: &#39;) &amp; a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;config&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;productionDb&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$env(&#39;DB_PROD_URL&#39;, &#39;mysql://prod.example.com:3306&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;productionDb&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$env(&#39;DB_PROD_URL&#39;, &#39;mysql://prod.example.com:3306&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;localDb&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql://localhost:3306&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;features&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;experimental&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;enabled&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;endpoint&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;https://api.example.com/config/&#39;) &amp; &#39;experimental&#39;}&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;experimental&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;enabled&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;endpoint&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;https://api.example.com/config/&#39;) &amp; &#39;experimental&#39;}&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;Will NOT be evaluated: &#39;) &amp; a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;note&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Will be evaluated: 42&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;config&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;productionDb&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$env(&#39;DB_PROD_URL&#39;, &#39;mysql://prod.example.com:3306&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;productionDb&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql://prod.example.com:3306&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;localDb&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql://localhost:3306&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;features&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;experimental&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;enabled&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;endpoint&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$string(&#39;https://api.example.com/config/&#39;) &amp; &#39;experimental&#39;}&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;experimental&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;enabled&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;endpoint&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://api.example.com/config/experimental&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>In these examples, <code>...</code> will be completely ignored during template processing - the expression will not be evaluated.</p>
<p>Note that array elements with &quot;&quot; in their values will still be processed, as array indices are numbers, not property names. Only object properties that start with &quot;&quot; are blocked.</p>
<a id="md:generative-templates" class="tsd-anchor"></a><h1><a href="#md:generative-templates">Generative Templates</a></h1><p>Templates can contain generative expressions that cause their content to change over time. 
For instance the <code>$setInterval</code> function behaves exactly as it does in Javascript. Below, 
it causes the <code>incr</code> function to be called forever, every 10 ms.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/tail.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;incr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${function(){$set(&#39;/counter&#39;,counter+1)}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;upCount&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${  $setInterval(incr, 10)  }&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The <code>tail</code> command can be used to watch changes on a particular field. Below we use <code>--tail &quot;/ until counter=5&quot;</code> to tail 
the document root until the value of counter reaches 5, at which point <code>--tail</code> stops
producing output, though the <code>incr</code> function is still being called every 10 ms.
field:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/tail.json&quot;</span><span class="hl-1"> --tail </span><span class="hl-2">&quot;/ until counter=5&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;incr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;upCount&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;--interval/timeout--&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Here was have a more complex example, again using $setInterval to increment a counter
that drives rotation and scrolling of arrays and strings.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/tailgraphs.yaml&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;i&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;mod&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${i%10}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;ms&quot;</span><span class="hl-1">: </span><span class="hl-6">30</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;chars&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-1">   ],</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;wave&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;................==................................................................==................................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;.............o......o..........................................................o......o.............................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;..........o............o....................................................o............o..........................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;........o................o................................................o................o........................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;......o....................o............................................o....................o......................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;.....o......................o..........................................o......................o.....................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;...o..........................o......................................o..........................o...................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;..o............................o....................................o............................o..................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;.o...............................o.................................o...............................o................................&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;..................................o..............................o..................................o..............................o&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;...................................o............................o....................................o............................o.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;....................................o..........................o......................................o..........................o..&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;......................................o......................o..........................................o......................o....&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;.......................................o....................o............................................o....................o.....&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;.........................................o................o................................................o................o.......&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;...........................................o............o....................................................o............o.........&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;..............................................o......o..........................................................o......o............&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;.................................................==................................................................==...............&quot;</span><br/><span class="hl-1">   ],</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;chart&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-1">   ],</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;rot&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${  function($arr){$arr.($substring($, $$.i%$length($)) &amp; $substring($, 0, $$.i%$length($)))}     }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;incr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function(){ $set(&#39;/i&#39;, i+1) } }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;upCount&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${  $setInterval(incr, ms)  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;scroll&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${  function($arr){ $arr[[$$.mod..9]] ~&gt; $append($arr[[0..$$.mod]])}     }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;stars&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${[1..$$.i%20].($=19?&#39;&#39;:&#39;&#39;)~&gt;$join}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;wavy&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ (i;rot(wave)) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;rotate&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ (i;rot(chars)) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;scrolled&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ (i;scroll(chars))}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;moveBars&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ (i;scroll(chart))}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Setting <code>--tail /</code> instructs the REPL to tail the root of the
document &quot;in place&quot; so the screen does not scroll and you can observe
live changes to the json document.</p>
<p><code>&gt; .init -f &quot;example/tailgraphs.yaml&quot; --tail /</code>
<img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/tailgraphs.gif" width="800" height="400" alt="Alt text for the GIF" /></p>
<a id="md:reactive-behavior" class="tsd-anchor"></a><h1><a href="#md:reactive-behavior">Reactive Behavior</a></h1><p>Stated is naturally reactive. In the example below, <code>story</code> will evaluate when the promises for <code>partI</code> and <code>partII</code> have both
resolved, simply because <code>story</code> has references to <code>partI</code> and <code>partII</code>, each of which respectively is triggered by the 
resolution of the two fetch functions they each depend on.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex21.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;call&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${function($url){$fetch($url) ~&gt; handleRes}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;falcon&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/starships/?name=Millennium&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;han&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/people/?name=han&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():$res.status?{&#39;status&#39;: $res.status}:$res} }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;luke&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/people/?name=luke&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [han, &#39;piloted the&#39;, falcon] ~&gt; $join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [luke, &#39;piloted the&#39;, xwing] ~&gt; $join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;story&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [partI, &#39;then&#39;, partII]~&gt;$join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;xwing&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/starships/?name=x-wing&#39;).result[0].properties.name}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .plan</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/handleRes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/call&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/falcon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/han&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/luke&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/partI&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/xwing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/partII&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/story&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;story&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Han Solo piloted the Millennium Falcon then Luke Skywalker piloted the X-wing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;call&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Han Solo piloted the Millennium Falcon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;luke&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Luke Skywalker&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;xwing&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;X-wing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Luke Skywalker piloted the X-wing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;han&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Han Solo&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;falcon&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Millennium Falcon&quot;</span><br/><span class="hl-1">} </span>
</code><button>Copy</button></pre>
<a id="md:svg-command" class="tsd-anchor"></a><h2><a href="#md:svg-command">SVG command</a></h2><p>The .svg command serves an SVG diagram of the DAG</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex21.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;story&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [partI, &#39;then&#39;, partII]~&gt;$join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():$res.status?{&#39;status&#39;: $res.status}:$res} }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;call&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${function($url){$fetch($url) ~&gt; handleRes}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [han, &#39;piloted the&#39;, falcon] ~&gt; $join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;luke&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/people/?name=luke&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;xwing&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/starships/?name=x-wing&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [luke, &#39;piloted the&#39;, xwing] ~&gt; $join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;han&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/people/?name=han&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;falcon&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/starships/?name=Millennium&#39;).result[0].properties.name}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .svg --port=</span><span class="hl-6">4042</span><br/><span class="hl-1">Server is running on port </span><span class="hl-6">4042</span><br/><span class="hl-2">&quot;http://localhost:4042&quot;</span>
</code><button>Copy</button></pre>
<p>Access the URL from your web browser to view the SVG diagram.
<img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/df9b46590c28285a06bce7aa4948fe62042345f1/starwarsgraph.svg" alt="starwars svg"></p>
<a id="md:yaml" class="tsd-anchor"></a><h2><a href="#md:yaml">YAML</a></h2><p>Input can be provided in YAML. YAML is convenient because JSONata prorgrams are often multi-line, and json does not 
support text blocks with line returns in a way that is readable. For instance if we compare ex12.json and ex12.yaml, 
which is more readable?</p>
<pre><code class="language-json"><span class="hl-1">falken$ cat ex</span><span class="hl-6">12</span><span class="hl-1">.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;selectedGame&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${game.selected}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;respHandler&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():{&#39;error&#39;: $res.status}} }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(url) ~&gt; respHandler ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}| }&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>In YAML the <code>respHandler</code> function can be written as a text block, whereas in JSON it must appear on a single line.</p>
<pre><code class="language-bash"><span class="hl-0">falken$</span><span class="hl-1"> </span><span class="hl-2">cat</span><span class="hl-1"> </span><span class="hl-2">ex12.yaml</span>
</code><button>Copy</button></pre>
<pre><code class="language-yaml"><span class="hl-11">url</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><br/><span class="hl-11">selectedGame</span><span class="hl-1">: </span><span class="hl-2">&quot;${game$.selected}&quot;</span><br/><span class="hl-11">respHandler$</span><span class="hl-1">: </span><span class="hl-8">|</span><br/><span class="hl-12">  function($res){</span><br/><span class="hl-12">    $res.ok? $res.json():{&#39;error&#39;: $res.status}</span><br/><span class="hl-12">  }</span><br/><span class="hl-11">game$</span><span class="hl-1">: </span><span class="hl-2">&quot;$fetch(url) ~&gt; respHandler$ ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}|&quot;</span>
</code><button>Copy</button></pre>
<p>However, once a YAML file is parsed with the JavaScript runtime it becomes a JavaScript
object. Hence, in the example below a YAML is the input file, but the REPL displays the resulting Javascript object 
using JSON syntax. As we can see below, loading the yaml file still results in the function being deisplayed
as it&#39;s parsed in-memory JS representation.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex12.yaml&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;selectedGame&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${game$.selected}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;respHandler$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;function($res){</span><span class="hl-10">\n</span><span class="hl-2">  $res.ok? $res.json():{&#39;error&#39;: $res.status}</span><span class="hl-10">\n</span><span class="hl-2">}</span><span class="hl-10">\n</span><span class="hl-2">&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;$fetch(url) ~&gt; respHandler$ ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}|&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:setting-values-in-the-stated-repl" class="tsd-anchor"></a><h2><a href="#md:setting-values-in-the-stated-repl">Setting Values in the stated REPL</a></h2><p>The stated REPL also allows you to dynamically set values in your templates, further aiding in debugging and development.
In the example below <code>.set /a/0 100</code> sets a[0] to 100. The syntax of <code>/a/0</code> is <a href="https://datatracker.ietf.org/doc/html/rfc6901">RFC-6901 JSON Pointer</a>.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex09.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${ $[0] + $[1] }&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .set /a/</span><span class="hl-6">0</span><span class="hl-1"> </span><span class="hl-6">100</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">100</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">101</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:expression-scope-1" class="tsd-anchor"></a><h2><a href="#md:expression-scope-1">Expression Scope</a></h2><p>Individual JSONata programs are embedded in JSON files between <code>${..}</code>. What is the input to the JSONata program? 
The input, by default, is the object or array that the expression resides in. For instance in the example <strong>above</strong>, you can see that the JSONata <code>$</code> variable refers to the array itself. Therefore, expressions like <code>$[0]</code>
refer to the first element of the array. </p>
<a id="md:rerooting-expressions-1" class="tsd-anchor"></a><h2><a href="#md:rerooting-expressions-1">Rerooting Expressions</a></h2><p>In Stated templates, one way to declare a JSONata expression is by surrounding it by &quot;dollars moustaches&quot;.
E.g <code>${...some expression...}</code>. JSONata expressions always have a <a href="https://docs.jsonata.org/programming#built-in-variables">context</a>.
The <code>$</code> variable always points to the current context. The <code>$$</code> variable always points to the input (root context) for an 
expression.
In a Stated template, the root context for an expression is the object in which the expression is contained. For
Example:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/context.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${[c,&#39; and &#39;,$.c,&#39; and &#39;,$$.c,&#39; are the same thing. $ (current context) is /a, the object in which this expression resides&#39;]~&gt;$join}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello and hello and hello are the same thing. $ (current context) is /a, the object in which this expression resides&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Now we will show how we can change the context of an expression using &#39;rerooting.&#39; Rerooting allows the expression&#39;s root
context to be pointed anywhere in the json document.
In the example below, consider <code>greeting &amp; &#39;, &#39; &amp;  player1&#39;</code>. We want <code>player1</code> to refer to the content at json pointer <code>/player1</code> (the field named &#39;player1&#39; at the root of the document). 
But our expression <code>greeting &amp; &#39;, &#39; &amp;  player1</code> is located deep in the document at <code>/dialog/partI</code>. So how can we cause 
the root of the document to be the context for the JSONata expression <code>greeting &amp; &#39;, &#39; &amp;  player1</code>? 
You can reroot an expression in a different part of the document using relative rooting <code>../${&lt;expr&gt;}</code> syntax or you can root an
at the absolute doc root with <code>/${&lt;expr&gt;}</code>. The example below shows how expressions located below the root object, can
explicitly set their context using the rooting syntax. Both absolute rooting, <code>/${...}</code> and relative rooting <code>../${...}</code>
are shown.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex04.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player1&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player2&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Professor Falken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;dialog&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;../../${greeting &amp; &#39;, &#39; &amp;  player1}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;../../${greeting &amp; &#39;, &#39; &amp;  player2}&quot;</span><br/><span class="hl-1">     ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg3&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${player1 &amp; &#39;, would you like to play a game?&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg4&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${&#39;Certainly, &#39;&amp; player2 &amp; &#39;. How about a nice game of chess?&#39;}&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player1&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;player2&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Professor Falken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;dialog&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Hello, Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Hello, Professor Falken&quot;</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg3&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua, would you like to play a game?&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;msg4&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Certainly, Professor Falken. How about a nice game of chess?&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>An advanced rerooting operator is the <code>//</code> absolute root operator. The <code>/</code> rooting operator, that we showed above,  will never allow the expression
to &#39;escape&#39; outside of the template it was defined in. But what if we intend for a template to be imported into another template
and we expect there to be a variable defined in the other template that we should use? This is where the <code>//</code> absolute root
operator can be used. The <code>//</code> operator will set the expression context to the absolute root of whatever the final document is
after all imports have been performed.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/absoluteRoot.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;!${&#39;Professor Falken&#39;}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;//${&#39;Hello, &#39; &amp; to}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello, Professor Falken&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/importsAbsoluteRoot.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$import(&#39;example/absoluteRoot.json&#39;)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;greeting&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Hello, Joshua&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:dag" class="tsd-anchor"></a><h2><a href="#md:dag">DAG</a></h2><p>Templates can grow complex, and embedded expressions have dependencies on both literal fields and other calculated
expressions. stated is at its core a data flow engine. Stated analyzes the abstract syntax tree (AST) of JSONata
expressions and builds a Directed Acyclic Graph (DAG). Stated ensures that when fields in your JSON change, that the
changes flow through the DAG in an optimal order that avoids redundant expression calculation.</p>
<p>stated helps you track and debug transitive dependencies in your templates. You can use the
<code>from</code> and <code>to</code> commands to track the flow of data. Their output is an ordered list of JSON Pointers, showing
you the order in which changes propagate.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex01.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${a}&quot;</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;the answer is: &#39;&amp; b}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;the answer is: 42&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .from /a</span><br/><span class="hl-1">[</span><br/><span class="hl-2">&quot;/a&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;/b&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;/c&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .to /b</span><br/><span class="hl-1">[</span><br/><span class="hl-2">&quot;/a&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;/b&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .to /c</span><br/><span class="hl-1">[</span><br/><span class="hl-2">&quot;/a&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;/b&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;/c&quot;</span><br/><span class="hl-1">]</span>
</code><button>Copy</button></pre>
<p>The <code>.plan</code> command shows you the execution plan for evaluating the entire template as a whole, which is what happens
when you run the <code>out</code> command. The execution plan always ensures the optimal data flow so that no expression is
evaluated twice.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex08.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${c}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${d+1+e}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${b+1}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${e+1}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;e&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .plan</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/d&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/b&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/c&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/a&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;d&quot;</span><span class="hl-1">: </span><span class="hl-6">2</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;e&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:visualizing-the-plan-with-svg-command" class="tsd-anchor"></a><h2><a href="#md:visualizing-the-plan-with-svg-command">visualizing the plan with .svg command</a></h2><pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex21.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;call&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${function($url){$fetch($url) ~&gt; handleRes}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;falcon&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/starships/?name=Millennium&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;han&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/people/?name=han&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():$res.status?{&#39;status&#39;: $res.status}:$res} }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;luke&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/people/?name=luke&#39;).result[0].properties.name}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;partI&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [han, &#39;piloted the&#39;, falcon] ~&gt; $join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;partII&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [luke, &#39;piloted the&#39;, xwing] ~&gt; $join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;story&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ [partI, &#39;then&#39;, partII]~&gt;$join(&#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;xwing&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ call(&#39;https://swapi.tech/api/starships/?name=x-wing&#39;).result[0].properties.name}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .svg --port=</span><span class="hl-6">4042</span><br/><span class="hl-1">Server is running on port </span><span class="hl-6">4042</span><br/><span class="hl-2">&quot;http://localhost:4042&quot;</span>
</code><button>Copy</button></pre>
<p>Access the URL from your web browser to view the SVG diagram.
<img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/df9b46590c28285a06bce7aa4948fe62042345f1/starwarsgraph.svg" alt="starwars svg"></p>
<a id="md:concurrency" class="tsd-anchor"></a><h1><a href="#md:concurrency">Concurrency</a></h1><p>Stated executes expressions in your template according to a plan. The ordering of the plan is critical to ensuring correctness.
As we have seen in the section on reactive behavior, a plan is an array of JSON pointers, each json pointer pointing
to an expression in the template that must be evaluated. The DAG section of this document discusses plans like this:</p>
<pre><code class="language-json"><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/handleRes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/call&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/falcon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/han&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/luke&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/partI&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/xwing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/partII&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/story&quot;</span><br/><span class="hl-1">]</span>
</code><button>Copy</button></pre>
<p>Now we are going to discuss what happens if we introduce concurrent behavior. Concurrency can happen if an external 
actor, like your code using the stated library, mutates a field of the template concurrently. For example by creating an
array of Promises that each change a field, and calling Promises.all. Concurrency can also happen inside your template
itself by using <code>$timeout</code> and <code>$interval</code> which schedule functions on the event loop. Stated cannot allow two plans 
to concurrently access the same set of variables in the template, as this will cause behavior that is inconsistent with
the expected behavior of a plan. Therefore, this section discusses how Stated provides correct and performant behavior
when concurrent mutations trigger concurrent plan execution.</p>
<a id="md:serialized-mutations" class="tsd-anchor"></a><h2><a href="#md:serialized-mutations">Serialized Mutations</a></h2><p>A template has a single set of variables. What you see is what you get. The fields of the JSON are the variables
of the program. Using <code>$timeout</code> and <code>$interval</code> causes concurrent behavior. In an ordinary program, concurrent 
modifications to shared state cause unexpected behavior. Not so in stated. Much like a database that implements
<a href="https://www.postgresql.org/docs/current/transaction-iso.html#:~:text=13.2.-,3.,%2C%20serially%2C%20rather%20than%20concurrently.">SERIALIZABLE</a> 
isolation level, stated queues and serializes mutations to the template. Lets see what happens
when we map over an array of 10 integers, using a <code>$timeout</code> to generate concurrent mutations for each integer:</p>
<pre><code class="language-shell"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">cat</span><span class="hl-1"> </span><span class="hl-2">example/concurrentTimeouts.yaml</span><br/><span class="hl-0">start:</span><span class="hl-1"> |</span><br/><span class="hl-1">  ${</span><br/><span class="hl-1">      [1..10].(</span><br/><span class="hl-1">                </span><span class="hl-3">$setTimeout</span><span class="hl-1">(</span><br/><span class="hl-1">                    </span><span class="hl-3">function</span><span class="hl-1">(){</span><br/><span class="hl-1">                      </span><span class="hl-3">$set</span><span class="hl-1">(</span><span class="hl-2">&#39;/step1&#39;</span><span class="hl-1">, </span><span class="hl-3">$string</span><span class="hl-1">($))</span><br/><span class="hl-1">                    }</span><span class="hl-0">,</span><span class="hl-1"> </span><span class="hl-3">$random</span><span class="hl-1">()</span><span class="hl-4">*</span><span class="hl-2">100</span><span class="hl-1">)</span><br/><span class="hl-1">              )</span><br/><span class="hl-1">  }</span><br/><span class="hl-0">step1:</span><span class="hl-1"> </span><span class="hl-2">NA</span><br/><span class="hl-0">step2:</span><span class="hl-1"> ${</span><span class="hl-3">step1</span><span class="hl-1"> &amp; </span><span class="hl-2">&#39;:&#39;</span><span class="hl-1"> &amp; </span><span class="hl-3">step1</span><span class="hl-1">}</span><br/><span class="hl-0">step3:</span><span class="hl-1"> ${</span><span class="hl-3">step2</span><span class="hl-1"> &amp; </span><span class="hl-2">&#39;:&#39;</span><span class="hl-1"> &amp; </span><span class="hl-3">step2</span><span class="hl-1">}</span><br/><span class="hl-0">step4:</span><span class="hl-1"> ${</span><span class="hl-3">$set</span><span class="hl-1">(</span><span class="hl-2">&#39;/final/-&#39;</span><span class="hl-1">, </span><span class="hl-3">step3</span><span class="hl-1">)}</span><br/><span class="hl-0">final:</span><span class="hl-1"> []</span>
</code><button>Copy</button></pre>
<p>the $random timeout causes the /step1 plan to execute out of order with regard to the iputs [1..10]. However, due to 
Stated plan serialization, each input propagates through the execution plan while other inputs are locked out. This
guarantees that every value in the final array is correct. For instance we never see &quot;3:3:9:9&quot; which would indicate
that the input <code>3</code> had been allowed to begin its plan execution before `9&#39; had completed its plan. As expected, the 
outputs are correct, but in a random order.</p>
<pre><code class="language-yaml"><span class="hl-1"> </span><span class="hl-2">&quot;final&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;NA:NA:NA:NA&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;5:5:5:5&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;4:4:4:4&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;6:6:6:6&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;10:10:10:10&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;2:2:2:2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;9:9:9:9&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;7:7:7:7&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;8:8:8:8&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;3:3:3:3&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;1:1:1:1&quot;</span><br/><span class="hl-1">]</span>
</code><button>Copy</button></pre>
<a id="md:atomic-state-updates" class="tsd-anchor"></a><h2><a href="#md:atomic-state-updates">Atomic State Updates</a></h2><p>Stated Workflows provides an atomic primitive that prevents <a href="https://medium.com/@bindubc/distributed-system-concurrency-problem-in-relational-database-59866069ca7c#:~:text=Lost%20Update%20Problem%3A&text=In%20simple%20words%2C%20when%20two,update%20of%20the%20first%20transaction.">lost-updates</a>
with concurrent mutations of arrays.  It does this by using a
special JSON pointer defined by <a href="https://datatracker.ietf.org/doc/html/rfc6902#appendix-A.16">RFC 6902 JSON Patch for appending to an array</a>.
The example above uses this technique to with <code>$set(&#39;final/-&#39;, step2)</code>. Although serialized mutations actually prevents concurrent
updates, the <code>$forked</code> command allows for plans to truly run in parallel. Atomic array patching ensures that none of the 
concurrent plans will erase data from any other plan when they share an array.</p>
<a id="md:multi-version-concurrency-control-mvcc-and--forked" class="tsd-anchor"></a><h2><a href="#md:multi-version-concurrency-control-mvcc-and--forked">Multi Version Concurrency Control (MVCC) and  $forked</a></h2><p>When plans are concise data computations, serialization can be a good strategy. However, what if the steps of the plan
involves talking to external rest services? Serializing these plans will dramatically reduce the throughput
of plan execution. This is where the <code>$forked</code> and <code>$joined</code> functions come into play. In the example below, we map
over the <code>names</code> array and each element (<code>$</code>) is <code>$forked</code> on the <code>/name</code>. When a plan is forked, a copy is made in 
memory of the state. This is called Multi Version Concurrency Control (MVCC) and it allows each forked execution plan 
to operate on an isolated, complete, state. There is no serialization of plans. Each of the 10 names has a plan that 
is executing concurrently. </p>
<pre><code class="language-json"><span class="hl-1">names: ${</span><span class="hl-13">[&#39;luke&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;han&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;leia&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;chewbacca&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;darth&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;ben&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;c-3po&#39;,</span><span class="hl-1"> </span><span class="hl-13">&#39;yoda&#39;].($forked(&#39;/name&#39;,$))</span><span class="hl-1">}</span><br/><span class="hl-1">name: obi</span><br/><span class="hl-1">personDetails: ${ </span><span class="hl-13">$fetch(&#39;https</span><span class="hl-1">:</span><span class="hl-7">//swapi.tech/api/people/?name=&#39;&amp;name).json().result[0]}</span><br/><span class="hl-13">homeworldURL:</span><span class="hl-1"> </span><span class="hl-13">$</span><span class="hl-1">{ </span><span class="hl-13">personDetails.properties.homeworld</span><span class="hl-1">}</span><br/><span class="hl-13">homeworldDetails:</span><span class="hl-1"> </span><span class="hl-13">$</span><span class="hl-1">{ </span><span class="hl-13">$fetch(homeworldURL).json().result</span><span class="hl-1"> }</span><br/><span class="hl-13">homeworldName:</span><span class="hl-1"> </span><span class="hl-13">$</span><span class="hl-1">{ </span><span class="hl-13">$joined(&#39;/homeworlds/-&#39;,</span><span class="hl-1"> </span><span class="hl-13">homeworldDetails.properties.name)</span><span class="hl-1">}</span><br/><span class="hl-13">homeworlds:</span><span class="hl-1"> []</span>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/homeworlds-forked.yaml --tail </span><span class="hl-2">&quot;/homeworlds until $count($)=9&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">[</span><br/><span class="hl-2">&quot;Corellia&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;unknown&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Alderaan&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Tund&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Stewjon&quot;</span><span class="hl-1">,</span><br/><span class="hl-2">&quot;Kashyyyk&quot;</span><br/><span class="hl-1">]</span><br/>
</code><button>Copy</button></pre>
<p>Let&#39;s add some timing so we can understand tha effect of $forked on performance for I/O heavy plans
like this, with multiple HTTP fetches. </p>
<pre><code class="language-shell"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">cat</span><span class="hl-1"> </span><span class="hl-2">example/homeworlds-forked-timed.yaml</span><br/><span class="hl-0">startTime$:</span><span class="hl-1"> </span><span class="hl-3">$millis</span><span class="hl-1">()</span><br/><span class="hl-0">data$:</span><span class="hl-1"> |</span><br/><span class="hl-1">  (</span><br/><span class="hl-1">    </span><span class="hl-0">startTime$</span><span class="hl-1">;</span><br/><span class="hl-1">    [</span><span class="hl-2">&#39;luke&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;han&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;leia&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;chewbacca&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;darth&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;ben&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;c-3po&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;yoda&#39;</span><span class="hl-1">]</span><span class="hl-0">.</span><span class="hl-1">(</span><span class="hl-3">$forked</span><span class="hl-1">(</span><span class="hl-0">&#39;/name&#39;</span><span class="hl-0">,$</span><span class="hl-1">))</span><br/><span class="hl-1">  )</span><br/><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-2">obi</span><br/><span class="hl-0">personDetails:</span><span class="hl-1"> ${ </span><span class="hl-3">$fetch</span><span class="hl-1">(</span><span class="hl-2">&#39;https://swapi.tech/api/people/?name=&#39;</span><span class="hl-1">&amp;</span><span class="hl-3">name</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">().</span><span class="hl-3">result</span><span class="hl-1">[0]}</span><br/><span class="hl-0">homeworldURL:</span><span class="hl-1"> ${ </span><span class="hl-3">personDetails</span><span class="hl-1">.</span><span class="hl-3">properties</span><span class="hl-1">.</span><span class="hl-3">homeworld</span><span class="hl-1">}</span><br/><span class="hl-0">homeworldDetails:</span><span class="hl-1"> ${ </span><span class="hl-3">$fetch</span><span class="hl-1">(</span><span class="hl-3">homeworldURL</span><span class="hl-1">).</span><span class="hl-3">json</span><span class="hl-1">().</span><span class="hl-3">result</span><span class="hl-1"> }</span><br/><span class="hl-0">homeworldName:</span><span class="hl-1"> ${ </span><span class="hl-3">$joined</span><span class="hl-1">(</span><span class="hl-2">&#39;/homeworlds/-&#39;</span><span class="hl-1">, </span><span class="hl-3">homeworldDetails</span><span class="hl-1">.</span><span class="hl-3">properties</span><span class="hl-1">.</span><span class="hl-3">name</span><span class="hl-1">)}</span><br/><span class="hl-0">homeworlds:</span><span class="hl-1"> []</span><br/><span class="hl-0">totalTime$:</span><span class="hl-1"> </span><span class="hl-3">$string</span><span class="hl-1">(</span><span class="hl-0">$millis</span><span class="hl-1">()-startTime$) &amp; </span><span class="hl-0">&#39; ms&#39;</span>
</code><button>Copy</button></pre>
<p>Note that we make sure to include a trivial dependency on <code>startTime$</code>
from the <code>data$</code> expression. This ensures that <code>startTime$</code> is calculated first. We will run the .plan
command to verify this.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/homeworlds-forked.yaml --tail </span><span class="hl-2">&quot;/homeworlds until $count($)=9&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">[</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;unknown&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Kashyyyk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Alderaan&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Corellia&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Tund&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;Stewjon&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .plan</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/startTime$&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/data$&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/personDetails&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/homeworldURL&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/homeworldDetails&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/homeworldName&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/totalTime$&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out /homeworlds</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Alderaan&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;unknown&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Kashyyyk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tund&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Corellia&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Stewjon&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out /totalTime$</span><br/><span class="hl-2">&quot;781 ms&quot;</span>
</code><button>Copy</button></pre>
<p>Let&#39;s contrast the performance with the default SERIALIZED isolation level.</p>
<pre><code class="language-yaml"><span class="hl-12">$ cat  example/homeworlds-serialized-timed.yaml</span><br/><span class="hl-11">startTime$</span><span class="hl-1">: </span><span class="hl-12">$millis()</span><br/><span class="hl-11">data$</span><span class="hl-1">: </span><span class="hl-8">|</span><br/><span class="hl-12">  (</span><br/><span class="hl-12">    startTime$;</span><br/><span class="hl-12">    [&#39;luke&#39;, &#39;han&#39;, &#39;leia&#39;, &#39;chewbacca&#39;, &#39;darth&#39;, &#39;ben&#39;, &#39;c-3po&#39;, &#39;yoda&#39;].(</span><br/><span class="hl-12">      $setTimeout(function(){$set(&#39;/name&#39;,$)})</span><br/><span class="hl-12">    )</span><br/><span class="hl-12">  )</span><br/><span class="hl-11">name</span><span class="hl-1">: </span><span class="hl-12">obi</span><br/><span class="hl-11">personDetails</span><span class="hl-1">: </span><span class="hl-12">${ $fetch(&#39;https://swapi.tech/api/people/?name=&#39;&amp;name).json().result[0]}</span><br/><span class="hl-11">homeworldURL</span><span class="hl-1">: </span><span class="hl-12">${ personDetails.properties.homeworld}</span><br/><span class="hl-11">homeworldDetails</span><span class="hl-1">: </span><span class="hl-12">${ $fetch(homeworldURL).json().result }</span><br/><span class="hl-11">homeworldName</span><span class="hl-1">: </span><span class="hl-12">${ $set(&#39;/homeworlds/-&#39;, homeworldDetails.properties.name)}</span><br/><span class="hl-11">homeworlds</span><span class="hl-1">: []</span><br/><span class="hl-11">totalTime$</span><span class="hl-1">: </span><span class="hl-12">(homeworlds;$string($millis()-startTime$) &amp; &#39; ms&#39;)</span>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/homeworlds-serialized-timed.yaml --tail </span><span class="hl-2">&quot;/homeworlds until $count($)=9&quot;</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Stewjon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Corellia&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Alderaan&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;unknown&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tund&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Kashyyyk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out /homeworlds</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Corellia&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Alderaan&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Kashyyyk&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tund&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;Tatooine&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;unknown&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;unknown&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out /totalTime$</span><br/><span class="hl-2">&quot;6290 ms&quot;</span>
</code><button>Copy</button></pre>
<p>The <code>$forked</code> variation runs in 781 ms, while the SERIALIZED version ran in 6290 ms. The forked version is 8x faster.</p>
<a id="md:yaml-1" class="tsd-anchor"></a><h1><a href="#md:yaml-1">YAML</a></h1><p>Input can be provided in YAML. YAML is convenient because JSONata prorgrams are often multi-line, and json does not 
support text blocks with line returns in a way that is readable. For instance if we compare ex12.json and ex12.yaml, 
which is more readable?</p>
<pre><code class="language-json"><span class="hl-1">falken$ cat ex</span><span class="hl-6">12</span><span class="hl-1">.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;selectedGame&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${game.selected}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;respHandler&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():{&#39;error&#39;: $res.status}} }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(url) ~&gt; respHandler ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}| }&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>In YAML the <code>respHandler</code> function can be written as a text block, whereas in JSON it must appear on a single line.</p>
<pre><code class="language-bash"><span class="hl-0">falken$</span><span class="hl-1"> </span><span class="hl-2">cat</span><span class="hl-1"> </span><span class="hl-2">ex12.yaml</span>
</code><button>Copy</button></pre>
<pre><code class="language-yaml"><span class="hl-11">url</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><br/><span class="hl-11">selectedGame</span><span class="hl-1">: </span><span class="hl-2">&quot;${game$.selected}&quot;</span><br/><span class="hl-11">respHandler$</span><span class="hl-1">: </span><span class="hl-8">|</span><br/><span class="hl-12">  function($res){</span><br/><span class="hl-12">    $res.ok? $res.json():{&#39;error&#39;: $res.status}</span><br/><span class="hl-12">  }</span><br/><span class="hl-11">game$</span><span class="hl-1">: </span><span class="hl-2">&quot;$fetch(url) ~&gt; respHandler$ ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}|&quot;</span>
</code><button>Copy</button></pre>
<p>However, once a YAML file is parsed with the JavaScript runtime it becomes a JavaScript
object. Hence, in the example below a YAML is the input file, but the REPL displays the resulting Javascript object 
using JSON syntax. As we can see below, loading the yaml file still results in the function being deisplayed
as it&#39;s parsed in-memory JS representation.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex12.yaml&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;selectedGame&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${game$.selected}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;respHandler$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;function($res){</span><span class="hl-10">\n</span><span class="hl-2">  $res.ok? $res.json():{&#39;error&#39;: $res.status}</span><span class="hl-10">\n</span><span class="hl-2">}</span><span class="hl-10">\n</span><span class="hl-2">&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;$fetch(url) ~&gt; respHandler$ ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}|&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:complex-data-processing" class="tsd-anchor"></a><h1><a href="#md:complex-data-processing">Complex Data Processing</a></h1><p>The example below uses JSONata <code>$zip</code> function to combine related data.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex03.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;data&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fn&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;john&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;jane&quot;</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;ln&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;doe&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;smith&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;names&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $zip(data.fn, data.ln) }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;data&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fn&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;john&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;jane&quot;</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;ln&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;doe&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;smith&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;names&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;john&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;doe&quot;</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;jane&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;smith&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The example below uses the <code>$sum</code> function to compute a <code>costs</code> of each product, and then
again uses <code>$sum</code> to sum over the individual product costs to get the <code>totalCost</code>. In a round-about fashion each
individual product pulls in its cost from the costs array.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex10.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;totalCost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$sum(costs)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;costs&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${products.$sum(quantity * price)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;products&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Apple&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${costs[0]}&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Orange&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.75</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${costs[1]}&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Banana&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.25</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${costs[2]}&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .plan</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/costs&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/products/2/cost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/products/1/cost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/products/0/cost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/totalCost&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;totalCost&quot;</span><span class="hl-1">: </span><span class="hl-6">12</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;costs&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">2.5</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">7.5</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">2</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;products&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Apple&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-6">2.5</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Orange&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.75</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-6">7.5</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Banana&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.25</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-6">2</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<p>Here is a different approach in which cost of each product is computed locally
then rolled up to the totalCost. Note the difference in the execution <code>plan</code> between the example above and this example.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex11.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;totalCost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $sum(products.cost) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;products&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Apple&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ quantity*price }&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Orange&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.75</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ quantity*price }&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Banana&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.25</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ quantity*price }&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .plan</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/products/0/cost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/products/1/cost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/products/2/cost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/totalCost&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;totalCost&quot;</span><span class="hl-1">: </span><span class="hl-6">12</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;products&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Apple&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.5</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-6">2.5</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Orange&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.75</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-6">7.5</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Banana&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;quantity&quot;</span><span class="hl-1">: </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;price&quot;</span><span class="hl-1">: </span><span class="hl-6">0.25</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cost&quot;</span><span class="hl-1">: </span><span class="hl-6">2</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:functions" class="tsd-anchor"></a><h1><a href="#md:functions">Functions</a></h1><a id="md:jsonata-built-in" class="tsd-anchor"></a><h2><a href="#md:jsonata-built-in">JSONata built-in</a></h2><p>Stated functions behave exactly as functions described in <a href="https://docs.jsonata.org/programming#functions">JSONata Functions</a>.
All JSONata functions are available in Stated.</p>
<a id="md:stated-functions" class="tsd-anchor"></a><h2><a href="#md:stated-functions">Stated functions</a></h2><p>Stated provides many functions not provided out of the box by JSONata. </p>
<a id="md:env" class="tsd-anchor"></a><h3><a href="#md:env">$env</a></h3><p><code>$env</code> is a function used to read environment variables for Stated templates running in Node.js environment. A default value can 
be specified. If there is no default provided and no such variable exists in node <code>process.env</code> an error is returned.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/ex</span><span class="hl-6">24</span><span class="hl-1">.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;myVar&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $env(&#39;MY_VAR&#39;, &#39;default value&#39;) }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;myVar&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;default value&quot;</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:generate" class="tsd-anchor"></a><h3><a href="#md:generate">$generate</a></h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncGenerator">Generator functions</a>
can be used to cause a stated field to receive a series of values. Any field that is set to an AsyncGenerator will receive
the sequence of values from the iterator. You can use generators written in pure JS, like this from <code>example/myGenerator.mjs</code>:</p>
<pre><code class="language-javascript"><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function*</span><span class="hl-1"> </span><span class="hl-0">myGenerator</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-8">for</span><span class="hl-1"> (</span><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-3">i</span><span class="hl-1"> = </span><span class="hl-6">1</span><span class="hl-1">; </span><span class="hl-3">i</span><span class="hl-1"> &lt;= </span><span class="hl-6">10</span><span class="hl-1">; </span><span class="hl-3">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">        </span><span class="hl-8">yield</span><span class="hl-1"> </span><span class="hl-3">i</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>You can call <code>myGenerator</code> from your stated template, as demonstrated in <code>example/myGenerator.mjs</code>.
As you can see the final value of 10 is what remains when we execute the <code>.out</code> command. However,
keep in mind that all the values were sequentially pushed into the <code>generated</code> field, and we see only the final value.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/myGenerator.json --xf example/myGenerator.mjs</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$myGenerator()}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>If you are familiar with generators in JS, you know that generated values take a verbose form in which 
a <code>{value, done}</code> object is <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncGenerator/next#return_value">returned</a>.
If you wish to use the more verbose JS style of yielded/returned object, you can pass your generator 
to <code>$generate</code> and disable <code>valuesOnly</code>, as follows. Notice how the yielded values now contain the JS style 
<code>{value, done}</code></p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/myGeneratorVerbose.json --xf example/myGenerator.mjs</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$myGenerator()~&gt;$generate({&#39;valueOnly&#39;:false})}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;value&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;done&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;return&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>A slight variation on the example accumulates every value yielded by the generator:</p>
<pre><code class="language-json"><span class="hl-1">&gt;  .init -f example/myGenerator</span><span class="hl-6">2</span><span class="hl-1">.json --xf example/myGenerator.mjs</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$myGenerator()}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;onGenerated&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$set(&#39;/accumulator/-&#39;, $$.generated)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;accumulator&quot;</span><span class="hl-1">: []</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/myGenerator</span><span class="hl-6">2</span><span class="hl-1">.json --xf example/myGenerator.mjs --tail </span><span class="hl-2">&quot;/accumulator until $=[1,2,3,4,5,6,7,8,9,10]&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">[</span><br/><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-6">2</span><span class="hl-1">,</span><br/><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-6">4</span><span class="hl-1">,</span><br/><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-6">6</span><span class="hl-1">,</span><br/><span class="hl-6">7</span><span class="hl-1">,</span><br/><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-6">9</span><span class="hl-1">,</span><br/><span class="hl-6">10</span><br/><span class="hl-1">]</span><br/>
</code><button>Copy</button></pre>
<p>You already saw hoe the built-in <code>$generate</code> function can accept a JS AsyncGeneraotr, and options. But $generate 
can also be used to convert ordinary arrays or functions into async generators. When provided, the <code>interval</code> option, 
causes the provided array to yield its elements periodically. When a function is provided, as opposed to an array, the
function is called periodically.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/generate.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;delayMs&quot;</span><span class="hl-1">: </span><span class="hl-6">250</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">:</span><span class="hl-2">&quot;${[1..10]~&gt;$generate({&#39;interval&#39;:delayMs})}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/generate.json --tail </span><span class="hl-2">&quot;/ until generated=10&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-5">&quot;delayMs&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<p>This <code>example/myGenerator3.yaml</code> shows how you can call <code>return</code> and stop a generator.</p>
<pre><code class="language-yaml"><span class="hl-11">generated</span><span class="hl-1">: </span><span class="hl-12">${$generate($random, {&#39;interval&#39;:100, &#39;valueOnly&#39;:false})}</span><br/><span class="hl-11">onGenerated</span><span class="hl-1">: </span><span class="hl-12">${$set(&#39;/accumulator/-&#39;, generated.value)}</span><br/><span class="hl-11">accumulator</span><span class="hl-1">: []</span><br/><span class="hl-11">shutOff</span><span class="hl-1">: </span><span class="hl-12">${ $count(accumulator)=10?generated.return(&#39;finished!&#39;) }</span><span class="hl-1"> </span><span class="hl-7"># * shut off the generator when the accumulator has 10 items *</span><br/>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/myGenerator</span><span class="hl-6">3</span><span class="hl-1">.yaml --tail </span><span class="hl-2">&quot;/ until $count(accumulator)=10&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;value&quot;</span><span class="hl-1">: </span><span class="hl-6">0.7158161017599369</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;done&quot;</span><span class="hl-1">: </span><span class="hl-4">false</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;return&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;onGenerated&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/accumulator/-&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/shutOff&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;accumulator&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">0.9708143589815799</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.8066003597170972</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.8373617979948078</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.7594063106379574</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.5473418944379163</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.13642852595187982</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.25886999662811583</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.6100150330466272</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.5257481750954689</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.7158161017599369</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;shutOff&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;value&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;finished!&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;done&quot;</span><span class="hl-1">: </span><span class="hl-4">true</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The <code>maxYield</code> parameter can also be used to stop a generator:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/myGenerator</span><span class="hl-6">4</span><span class="hl-1">.yaml</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$generate($random, {&#39;interval&#39;:10, &#39;maxYield&#39;:5})}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;onGenerated&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$set(&#39;/accumulator/-&#39;, $$.generated)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;accumulator&quot;</span><span class="hl-1">: []</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f example/myGenerator</span><span class="hl-6">4</span><span class="hl-1">.yaml --tail </span><span class="hl-2">&quot;/ until $count(accumulator)=5&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;generated&quot;</span><span class="hl-1">: </span><span class="hl-6">0.5289126250886866</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;onGenerated&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/accumulator/-&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;accumulator&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">0.3260049204634301</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.4477190160739559</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.9414436597923774</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.8593436891141426</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">0.5289126250886866</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:accumulate-default-and-self" class="tsd-anchor"></a><h3><a href="#md:accumulate-default-and-self">accumulate, default, and self</a></h3><p><code>$accumulate</code> is in some ways the opposite of <code>$generate</code>. The <code>$accumulate</code> function takes two arguments:</p>
<ol>
<li>the accumulator - the array that will accumulate the item at its end</li>
<li>the item - the item that will be pushed on to the accumulator</li>
</ol>
<p><code>$accumulate</code> provides an efficient, copy free way to mutate an array in place. This example illustrates how to combine 
<code>$self</code> and <code>$default</code> to accumulate the output of a generator. <code>$self</code> refers to the value of <code>b</code> itself. On initialization 
<code>$self</code> us undefined, as its expression has not yet evaluated. Therefore to initialize <code>b</code> to a an empty array we can 
pass <code>$self</code> through the <code>$default</code> function, which will return [] when <code>$self</code> is undefined, but otherwise passes 
<code>$self</code> through. </p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/accumulate</span><span class="hl-6">1</span><span class="hl-1">.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${[1..10]~&gt;$generate({&#39;interval&#39;:25})}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$self~&gt;$default([])~&gt;$accumulate(a)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f example/accumulate</span><span class="hl-6">1</span><span class="hl-1">.json --tail </span><span class="hl-2">&quot;/ until a=10&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">2</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">4</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">5</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">6</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">7</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">9</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">10</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:settimeout" class="tsd-anchor"></a><h3><a href="#md:settimeout">$setTimeout</a></h3><p><code>$setTimeout</code> is the JavaScript <code>setTimeout</code> function. It receives a function and an timeout
expressed as milliseconds. The function is called after the timeout. Example <code>ex15.json</code> demonstrates an 
intersting use of <code>$setTimout</code>. The <code>counter</code> variable is updates, which causes <code>upCount$</code> to re-evaluate due to
its reactive dependency on <code>counter</code>. In this way, each time <code>counter</code> changes, it schedules its next change 1 second
in the future.:</p>
<pre><code class="language-json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;upCount$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;counter&lt;10 ? ($setTimeout(function(){$set(&#39;/counter&#39;, counter+1)}, 1000);&#39;counting&#39;):&#39;done&#39;&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/ex</span><span class="hl-6">15</span><span class="hl-1">.json --tail </span><span class="hl-2">&quot;/ until counter=3&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;upCount$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;counting&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt;</span>
</code><button>Copy</button></pre>
<a id="md:setinterval" class="tsd-anchor"></a><h3><a href="#md:setinterval">$setInterval</a></h3><p><code>$setInterval</code> is the JavaScript <code>setInterval</code> function. It receives a function and an interval
expressed as milliseconds. The function is called every inteval. Example <code>ex14.json</code> shows how reaction
to <code>counter</code> changing is used to clear the interval when count exceeds 10.:</p>
<pre><code class="language-json"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;incr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${function(){$set(&#39;/counter&#39;,counter+1)}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;upCount&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${  $setInterval(incr, 1000)  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;status&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${(counter&gt;10?($clearInterval(upCount);&#39;done&#39;):&#39;counting&#39;)}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/ex</span><span class="hl-6">14</span><span class="hl-1">.json --tail </span><span class="hl-2">&quot;/ until counter=3&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;incr&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;upCount&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;--interval/timeout--&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;status&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;counting&quot;</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:fetch" class="tsd-anchor"></a><h3><a href="#md:fetch">$fetch</a></h3><p>JSONata provides the standard JS fetch function. You can use it exactly as you would in JS, except that
Stated wraps fetch so that any exceptions are caught and converted to error objects. This is because JSONata
does not have excpetions as a language construct.</p>
<p>This example fetches JSON over the network and uses the JSONata transform operator to set the
<code>player</code> field on the fetched JSON.
<a href="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json">Here is the JSON file</a> that it downloads and operates on.
You can see why DAG and evaluation order matter. selectedGame does not exist until the game field has been populated by
fetch.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex12.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;selectedGame&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${game.selected}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;respHandler&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():{&#39;error&#39;: $res.status}} }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(url) ~&gt; respHandler ~&gt; |$|{&#39;player&#39;:&#39;dlightman&#39;}| }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;url&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/games.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;selectedGame&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Global Thermonuclear War&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;respHandler&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;titles&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;chess&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;checkers&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;backgammon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;poker&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Theaterwide Biotoxic and Chemical Warfare&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Global Thermonuclear War&quot;</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;selected&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Global Thermonuclear War&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;player&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;dlightman&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:import" class="tsd-anchor"></a><h3><a href="#md:import">$import</a></h3><p>The sequence below explains by example that the $import function which is used to fetch and initialize
remote templates (or local literal templates) into the current template</p>
<pre><code class="language-json"><span class="hl-1">&gt; .note </span><span class="hl-2">&quot;let&#39;s take a simple template...&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex17.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${commander.firstName &amp; &#39; &#39; &amp; commander.lastName}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${$join([commander.rank, commanderDetails.fullName], &#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${$count(systems)}&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .note </span><span class="hl-2">&quot;now let&#39;s see what it produced&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .note </span><span class="hl-2">&quot;what happens if we put it on the web and fetch it?&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex19.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ norad.commanderDetails  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(&#39;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/norad.json&#39;) ~&gt; handleRes }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():{&#39;error&#39;: $res.status}} }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt;  .note </span><span class="hl-2">&quot;If we look at the output, it&#39;s just the template.&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${commander.firstName &amp; &#39; &#39; &amp; commander.lastName}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${$join([commander.rank, commanderDetails.fullName], &#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${$count(systems)}&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${commander.firstName &amp; &#39; &#39; &amp; commander.lastName}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${$join([commander.rank, commanderDetails.fullName], &#39; &#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;../${$count(systems)}&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .note </span><span class="hl-2">&quot;Now let&#39;s use the import function on the template&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .init -f example/ex</span><span class="hl-6">16</span><span class="hl-1">.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ norad.commanderDetails  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $fetch(&#39;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/norad.json&#39;) ~&gt; handleRes ~&gt; $import}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($res){$res.ok? $res.json():{&#39;error&#39;: $res.status}} }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">   },</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">         </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">      ]</span><br/><span class="hl-1">   },</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;handleRes&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .note </span><span class="hl-2">&quot;You can see above that &#39;import&#39; makes it behave as a template, not raw JSON.&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .note </span><span class="hl-2">&quot;We don&#39;t have to fetch ourselves to use import, it will do it for us.&quot;</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex18.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ norad.commanderDetails  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $import(&#39;https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/norad.json&#39;)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:importing-bits-of-other-templates" class="tsd-anchor"></a><h4><a href="#md:importing-bits-of-other-templates">Importing bits of other templates</a></h4><p>Suppose you just want to import a function defined in another template. The <code>$import</code> function understands
URL fragments with JSON Pointers. In this example we use a URL with a fragment to import just a function
from a remote template. Note that the URL ends in <code>#/resourceMapperFn</code></p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/resourceMapperB.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;input&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;foo&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;bar&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;something&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;zap&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;zing&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;resourceMapperAFn&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$import(&#39;https://raw.githubusercontent.com/cisco-open/stated/main/example/resourceMapperA.json#/resourceMapperFn&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;resourceMapperBFn&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($in){$in.foo &lt; 30 and $in.zap=&#39;zing&#39;?[{&#39;type&#39;:&#39;B&#39;, &#39;id&#39;:$in.foo, &#39;bar&#39;:$in.bar, &#39;zap&#39;:$in.zing}]:[]}  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;BEntities&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ (resourceMapperBFn(input))}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;entities&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ BEntities?BEntities:resourceMapperAFn(input)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;input&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;foo&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;bar&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;something&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;zap&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;zing&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;resourceMapperAFn&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;resourceMapperBFn&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;BEntities&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;entities&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;Type&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;A&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;id&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;bar&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;something&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:setting-up-local-imports-with---importpath" class="tsd-anchor"></a><h4><a href="#md:setting-up-local-imports-with---importpath">Setting up local imports with --importPath</a></h4><p>You can import local files by specifying a folder where stated will look for the imported files</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/localImport.json&quot;</span><span class="hl-1"> --importPath=./example</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ norad.commanderDetails  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $import(&#39;ex17.json&#39;)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;noradCommander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;norad&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commanderDetails&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;fullName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;salutation&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General Jack Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;systemsUnderCommand&quot;</span><span class="hl-1">: </span><span class="hl-6">4</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;organization&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;NORAD&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;location&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Cheyenne Mountain Complex, Colorado&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;commander&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;firstName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Jack&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;lastName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Beringer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;rank&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;General&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;purpose&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Provide aerospace warning, air sovereignty, and defense for North America&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Ballistic Missile Early Warning System (BMEWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;North Warning System (NWS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Space-Based Infrared System (SBIRS)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Cheyenne Mountain Complex&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:import-javascript-es-modules" class="tsd-anchor"></a><h4><a href="#md:import-javascript-es-modules">Import Javascript ES modules</a></h4><p>Repl and cli support importing javascript functions. If provided file to --xf has a .js or .mjs extension, it will be
loaded and all exported functions will be added to TemplateProcessor&#39;s execution context.</p>
<p>An example &quot;src/test/test-export.js&quot; exports 3 functions</p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-0">barFunc</span><span class="hl-1"> = (</span><span class="hl-3">input</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`bar: </span><span class="hl-4">${</span><span class="hl-3">input</span><span class="hl-4">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// explicitly define exported functions and their names</span><br/><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-0">foo</span><span class="hl-1"> = () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;foo&quot;</span><span class="hl-1">;</span><br/><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">bar</span><span class="hl-1"> = </span><span class="hl-3">barFunc</span><span class="hl-1">;</span><br/><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-0">__init</span><span class="hl-1"> = (</span><span class="hl-3">templateProcessor</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-3">templateProcessor</span><span class="hl-1">.</span><span class="hl-0">setData</span><span class="hl-1">(</span><span class="hl-2">&quot;/messageFromInitFunction&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;__init sidecar succeeded&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The functions can be used in the stated template context by using the -xf argument which spreads
the exported values into the context making them accessible as <code>$</code> variables. For example the function <code>foo()</code> exported from the js module is available as <code>$foo</code>.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/importJS.json --xf=example/test-export.js</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;res&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $bar($foo()) }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;messageFromInitFunction&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;__init sidecar succeeded&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;res&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;bar: foo&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>This can be combined with the <code>--importPath</code> option to import files relative to that path</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/importJS.json --importPath=example --xf=test-export.js</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;res&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $bar($foo()) }&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;messageFromInitFunction&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;__init sidecar succeeded&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;res&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;bar: foo&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>you can also directly import an entire modules using the <code>$import</code> function from within a template.
You must set the --importPath. For instance, <code>example/myModule.mjs</code>contains functions <code>getGames</code> and <code>getPlayers</code> </p>
<pre><code class="language-js"><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-0">getGames</span><span class="hl-1">(){</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;chess&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;checkers&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;backgammon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;poker&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Theaterwide Biotoxic and Chemical Warfare&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;Global Thermonuclear War&quot;</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-0">getPlayers</span><span class="hl-1">(){</span><br/><span class="hl-1">    </span><span class="hl-8">return</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;dlightman&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;prof. Falken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">&quot;WOPR&quot;</span><br/><span class="hl-1">    ];</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Upon running <code>example/importLocalJsModule.yaml</code>, which does <code>$import(&#39;./myModule.mjs&#39;)</code> you will see the field <code>myModule</code>
contains the functions, which are called in the template.</p>
<pre><code class="language-yaml"><span class="hl-8">&gt;</span><span class="hl-13"> .init -f example/importLocalJsModule.yaml --importPath=example</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;myModule&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$import(&#39;./myModule.mjs&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;games&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${myModule.getGames()}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;players&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${myModule.getPlayers()}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-8">&gt;</span><span class="hl-13"> .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;myModule&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;getGames&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;getPlayers&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;games&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;chess&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;checkers&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;backgammon&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;poker&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Theaterwide Biotoxic and Chemical Warfare&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;Global Thermonuclear War&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;players&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;dlightman&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;prof. Falken&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;joshua&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;WOPR&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:the-__init-sidecar-function" class="tsd-anchor"></a><h4><a href="#md:the-__init-sidecar-function">The __init sidecar function</a></h4><p>If the es module exports a function named <code>__init</code>, this function will be invoked with the initialized TemplateProcessor
as an argument. This is useful as a &#39;sidecar&#39; if you want to add code to interact with the template you are loading in
the REPL. This example will inject a message into the template. Your function can be async. It&#39;s return value, if any
is ignored.</p>
<pre><code class="language-javascript"><span class="hl-8">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-0">__init</span><span class="hl-1"> = (</span><span class="hl-3">templateProcessor</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-3">templateProcessor</span><span class="hl-1">.</span><span class="hl-0">setData</span><span class="hl-1">(</span><span class="hl-2">&quot;/messageFromInitFunction&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;__init sidecar succeeded&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:open-1" class="tsd-anchor"></a><h3><a href="#md:open-1">$open</a></h3><p>Allowing expressions to open local files is a security risk. For this reason the core TemplateProcessor does
not support the $open function. However, the CLI/REPL which are for local usage allow the $open function. Additionally,
programs that want to allow properly guarded <code>$open</code> operations may inject a <code>$open</code> function of their choosing
into the TemplateProcessor contexet. $open accepts a relative path, and parses the JSON or YAML file on that path into
an object.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .note This shows two equivalent ways to open a json or yaml file using $open</span><br/><span class="hl-2">&quot;=============================================================&quot;</span><br/><span class="hl-1">&gt; .cd example</span><br/><span class="hl-2">&quot;Current directory changed to: /Users/falken/proj/jsonataexperiments/example&quot;</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;importLocal.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${&#39;ex01.json&#39;~&gt;$open~&gt;$import}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$import($open(&#39;ex01.json&#39;))}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;the answer is: 42&quot;</span><br/><span class="hl-1">   },</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;c&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;the answer is: 42&quot;</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .cd ..</span><br/><span class="hl-2">&quot;Current directory changed to: /Users/falken/proj/jsonataexperiments&quot;</span>
</code><button>Copy</button></pre>
<a id="md:set-1" class="tsd-anchor"></a><h3><a href="#md:set-1">$set</a></h3><p>You have already seen how the REPL <code>.set</code> command works. The REPL simply calls the internal $set function.
The <code>$set</code> function can be called from your JSONata blocks or function. The <code>$set</code> function is used to push data into
other parts of the template. The function signature is <code>$set(jsonPointer, value)</code>. The
set command returns an array of JSON Pointers that represent the transitive updates that resulted from calling <code>set</code>.
In the example below <code>$set(&#39;/systems/1&#39;, &#39;JOSHUA&#39;)</code> is used to push the string &quot;JOSHUA&quot; onto the <code>systems</code> array.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex13.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;WOPR&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;onBoot&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $set(&#39;/systems/1&#39;, &#39;JOSHUA&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;newSystem&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${systems[1]}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;newSystem&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;JOSHUA&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;onBoot&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/systems/1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/newSystem&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;systems&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;WOPR&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;JOSHUA&quot;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:debounce" class="tsd-anchor"></a><h3><a href="#md:debounce">$debounce</a></h3><p>Debouncing is a technique used in software development, particularly in web development and event handling,
to control or limit the frequency of a particular action or event when it occurs rapidly or frequently.
It helps prevent excessive or redundant executions of the action, making applications more efficient and
responsive.</p>
<p>In this example we rapidly change a counter and feed it into a debounced function that appends the count to
an accumulator array, <code>acc</code>. The <code>interval</code> is terminated when <code>count</code> reaches 100, and due to debouncing,
only a single value, 100, is written into <code>acc</code>. We use the <code>--tail &quot;/ until acc[0]=100&quot;</code> to tail the
root document (<code>/</code>) until a jsonata expression condition is met. The condition we check is
<code>acc[0]=100</code> which is the expected debounced value.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/debounce.yaml&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;acc&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;appendAcc&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($v){$set(&#39;/acc/-&#39;, $v)} ~&gt; $debounce(15)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${   function(){($set(&#39;/count&#39;, $$.count+1); $$.count)}    }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;rapidCaller&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$setInterval(counter~&gt;appendAcc, 10)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;stop&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ count=100?($clearInterval($$.rapidCaller);&#39;done&#39;):&#39;not done&#39;  }&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/debounce.yaml&quot;</span><span class="hl-1"> --tail </span><span class="hl-2">&quot;/ until acc[0]=100&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;acc&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">100</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">100</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;rapidCaller&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;--interval/timeout--&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;stop&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;done&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:defer" class="tsd-anchor"></a><h3><a href="#md:defer">$defer</a></h3><p>While <code>$debounce</code> is used to create a debounced function, <code>$defer</code> can be a more concise approach when you simply want a
&quot;slowed down&quot; version of a rapidly changing variable. $defer takes two arguments:</p>
<ol>
<li>The json pointer to the field you wish to defer (or &quot;slow down&quot;)</li>
<li>An optional number of milliseconds, T.</li>
</ol>
<p><code>$defer</code> will always produce one initial value, which comes from the deferred field. <code>$defer</code> will not produce a
subsequent value until the deferred field has remained unchanges for T ms.
For example, suppose you are collecting a query string from a user
input. Each character entered mutates the <code>query</code> field, but we don&#39;t want to do anything with <code>query</code> unless the user
pauses or stops typing characters. In the example below, an <code>$setInterval</code> call is used to simulate a user entering
the characters of a <code>sampleQuery</code> into the <code>query</code> field at a rate of one every 25ms. Fast typer! The <code>deferredQuery$</code> will begin with the inital value of <code>query</code> (&quot;&quot;) and remain unchanged
until the <code>query</code>stops receiving changes and reaches its final state of &quot;Would you like to play a game? How about a nice game of chess?&quot;</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/defer.yaml&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;sampleQuery&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Would you like to play a game? How about a nice game of chess?&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;query&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;deferredQuery$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;$defer(&#39;/query&#39;, 100)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;counter$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;function(){  $set(&#39;/count&#39;, count+1)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;appendQuery$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;$set(&#39;/query&#39;, sampleQuery~&gt;$substring(0,count))&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;rapidCaller$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;$setInterval(counter$, 25)&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;stop$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;count=$length(sampleQuery)</span><span class="hl-10">\n</span><span class="hl-2">  ?($clearInterval(rapidCaller$);&#39;done&#39;)</span><span class="hl-10">\n</span><span class="hl-2">  :&#39;simulating typing&#39;  </span><span class="hl-10">\n</span><span class="hl-2">&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>To watch the data changing we can use the <code>--tail until</code> to tail the changing template output until it reaches the final state.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/defer.yaml --tail </span><span class="hl-2">&quot;/ until deferredQuery$ = &#39;Would you like to play a game? How about a nice game of chess?&#39;&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;sampleQuery&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Would you like to play a game? How about a nice game of chess?&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;query&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Would you like to play a game? How about a nice game of chess?&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;deferredQuery$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;Would you like to play a game? How about a nice game of chess?&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">62</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;appendQuery$&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/query&quot;</span><br/><span class="hl-1">  ] ,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;rapidCaller$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;--interval/timeout--&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;stop$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;done&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Here is a screencapture showing the two commands above executed in the REPL.
<img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/taildefer.gif" alt="tailing deferred"></p>
<a id="md:ratelimit" class="tsd-anchor"></a><h3><a href="#md:ratelimit">$rateLimit</a></h3><p>Rate limiting allows to ensure than no than one function call is executed withing some time. For exameple,
we want to ensure that a function calling external APIs does not overload it.</p>
<pre><code class="language-json"><span class="hl-1">&gt;.init -f example/rateLimit.yaml</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;acc&quot;</span><span class="hl-1">: [],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;appendAcc&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($v){$set(&#39;/acc/-&#39;, $v)} ~&gt; $rateLimit(100)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${   function(){($set(&#39;/count&#39;, $$.count+1); $$.count)}    }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;rapidCaller&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$setInterval(counter~&gt;appendAcc, 10)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;stop&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ count=100?($clearInterval($$.rapidCaller);&#39;done&#39;):&#39;not done&#39;  }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;accCount&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ $count(acc) }&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Below output demonstrates, that <code>rateLimit</code> function calls to to set <code>acc</code> to once in no less than 100ms, which will
result in only 10 counts added o the <code>acc</code> array, the first one, the last one, and 10 in between.</p>
<pre><code class="language-json"><span class="hl-1">&gt;.init -f example/rateLimit.yaml --tail </span><span class="hl-2">&quot;/ until accCount=12&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;acc&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">10</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">19</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">28</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">38</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">48</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">57</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">66</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">75</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">85</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">94</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">100</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;counter&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">100</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;rapidCaller&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;--interval/timeout--&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;stop&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;done&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;accCount&quot;</span><span class="hl-1">: </span><span class="hl-6">12</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:custom-functions" class="tsd-anchor"></a><h2><a href="#md:custom-functions">Custom Functions</a></h2><p>Stated let&#39;s you define and call functions. Custom functions are simply JSONata functions. Functions
are not a feature of Stated, they are a feature of JSONata.</p>
<a id="md:simple-custom-function-example" class="tsd-anchor"></a><h3><a href="#md:simple-custom-function-example">Simple Custom Function Example</a></h3><pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex05.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;hello&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ (function($to){&#39;hello &#39; &amp; $to &amp; &#39;. How about a nice game of &#39; &amp; $$.game})}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;David&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;chess&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;greeting$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello(to)&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;hello&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;to&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;David&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;game&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;chess&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;greeting$&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;hello David. How about a nice game of chess&quot;</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:more-complex-function-example" class="tsd-anchor"></a><h3><a href="#md:more-complex-function-example">More Complex Function Example</a></h3><p>Here is an elaborate example of functions. The <code>fibonnaci</code> function itself is pulled into the last element of <code>x</code>
using the expression <code>/${fibonacci}</code>. The first element of the array contains <code>$[2]($[1])</code>. Can you see that
it invokes the <code>fibonacci</code> function passing it the value 6? Hint: <code>$[2]</code> is the last element of the array which
will pull in the <code>fibonacci</code> function and <code>$[1]</code> is the middle element of the array, holding the static value <code>6</code>.
So <code>$[2]($[1])</code> expands to <code>fibonacci(6)</code>. The value 6th fibonacci number is 8, which is what <code>fibonacci(6)</code> returns.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/ex06.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;x&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;${$[2]($[1])}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">6</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;/${fibonacci}&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;fibonacci&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${ function($n){$n=1?1:$n=0?0:fibonacci($n-1)+fibonacci($n-2)}}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;x&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-6">8</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-6">6</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;fibonacci&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;{function:}&quot;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Let&#39;s take a more complex example where we generate MySQL instances:</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/mysql.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;pn&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;providerName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;tmp&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${ [1..count].{&#39;database_instance.host&#39;:&#39;mysql-instance-&#39; &amp; $ &amp; &#39;.cluster-473653744458.us-west-2.rds.amazonaws.com&#39;}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;port&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${ [1..count].{&#39;database_instance.port:&#39;:$$.pn}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${[1..count].{&#39;cloud.provider&#39;: $$.providerName}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;instanceId&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${[1..count].{&#39;cloud.database_instance.id&#39;:&#39;db-mysql-instance-&#39; &amp; $formatBase($,16)}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;instanceName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${[1..count].{&#39;database_instance.name&#39;:&#39;MySQL instance&#39; &amp; $}}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;clusterName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;/${[1..count].{&#39;database_instance.cluster._name&#39;:&#39;MySQL cluster&#39; &amp; $}}&quot;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;instances&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${$zip(tmp.host, tmp.port, tmp.provider, tmp.instanceId, tmp.instanceName, tmp.clusterName)~&gt;$map($merge)}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;pn&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;providerName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;tmp&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;host&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-1.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;port&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;provider&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;instanceId&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-1&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;instanceName&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance1&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;clusterName&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster1&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;instances&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-1.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster1&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .from /count</span><br/><span class="hl-1">[</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/count&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/tmp/clusterName&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/tmp/host&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/tmp/instanceId&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/tmp/instanceName&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/tmp/port&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/tmp/provider&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;/instances&quot;</span><br/><span class="hl-1">]</span><br/><span class="hl-1">&gt; .set /count </span><span class="hl-6">3</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;count&quot;</span><span class="hl-1">: </span><span class="hl-6">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;pn&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;providerName&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;tmp&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;host&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-1.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-2.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-3.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;port&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;provider&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;instanceId&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-1&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-2&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-3&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;instanceName&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance1&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance2&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance3&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;clusterName&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster1&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster2&quot;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster3&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;instances&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-1.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance1&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster1&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-2.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster2&quot;</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.host&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;mysql-instance-3.cluster-473653744458.us-west-2.rds.amazonaws.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.port:&quot;</span><span class="hl-1">: </span><span class="hl-6">3306</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.provider&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;aws&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;cloud.database_instance.id&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;db-mysql-instance-3&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL instance3&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;database_instance.cluster._name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;MySQL cluster3&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:error-handling" class="tsd-anchor"></a><h1><a href="#md:error-handling">Error Handling</a></h1><a id="md:the-error-object" class="tsd-anchor"></a><h2><a href="#md:the-error-object">The error object</a></h2><p>if a JSONata expression evaluation throws an exception, the exception is converted to an error and placed
into the template output.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .log silent</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;log level&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;silent&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/errors.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${a + &#39; is not a string&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;JSONata evaluation exception&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;The right side of the </span><span class="hl-10">\&quot;</span><span class="hl-2">+</span><span class="hl-10">\&quot;</span><span class="hl-2"> operator must evaluate to a number&quot;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:error-reporting" class="tsd-anchor"></a><h2><a href="#md:error-reporting">Error Reporting</a></h2><p>The <code>.errors</code> command will produce a report of all errors in the template</p>
<pre><code class="language-json"><span class="hl-1">&gt; .log silent</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;log level&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;silent&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .init -f </span><span class="hl-2">&quot;example/errors.json&quot;</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: </span><span class="hl-6">42</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${a + &#39; is not a string&#39;}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .errors</span><br/><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-5">&quot;/b&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;JSONata evaluation exception&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;The right side of the </span><span class="hl-10">\&quot;</span><span class="hl-2">+</span><span class="hl-10">\&quot;</span><span class="hl-2"> operator must evaluate to a number&quot;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<a id="md:errorreport-function" class="tsd-anchor"></a><h2><a href="#md:errorreport-function">$errorReport function</a></h2><p>JSONata does not have a <code>throw/catch</code> syntax. However, JSONata has a <code>$error</code> function that you can use
to throw an error. However, doing so will end the execution of the JSONata expression. If you wish to
simply record the fact that an error occured without exiting the expression, use the <code>$errorReport</code> function
which returns an error object but does not throw.</p>
<pre><code class="language-json"><span class="hl-1">&gt; .init -f example/errorReport.json</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">2</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;${$errorReport(&#39;oops&#39;, &#39;my_custom_error&#39;)}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">4</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">5</span><br/><span class="hl-1">   ],</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;${($errorReport(&#39;e0&#39;);$errorReport(&#39;e1&#39;);$errorReport(&#39;e2&#39;))}&quot;</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .out</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;a&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">1</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">2</span><span class="hl-1">,</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;oops&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;my_custom_error&quot;</span><br/><span class="hl-1">         }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-6">4</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-6">5</span><br/><span class="hl-1">   ],</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;b&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;e2&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">}</span><br/><span class="hl-1">&gt; .errors</span><br/><span class="hl-1">{</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;/a/3&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;oops&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;name&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;my_custom_error&quot;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">   },</span><br/><span class="hl-1">   </span><span class="hl-5">&quot;/b&quot;</span><span class="hl-1">: [</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;e0&quot;</span><br/><span class="hl-1">         }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;e1&quot;</span><br/><span class="hl-1">         }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">         </span><span class="hl-5">&quot;error&quot;</span><span class="hl-1">: {</span><br/><span class="hl-1">            </span><span class="hl-5">&quot;message&quot;</span><span class="hl-1">: </span><span class="hl-2">&quot;e2&quot;</span><br/><span class="hl-1">         }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">   ]</span><br/><span class="hl-1">}</span><br/>
</code><button>Copy</button></pre>
<a id="md:templateprocessor-snapshots" class="tsd-anchor"></a><h1><a href="#md:templateprocessor-snapshots">TemplateProcessor Snapshots</a></h1><p>TemplateProcessor.snapshot allows you to capture template state at a point in time. The snapshot can be used to restore 
and continue template execution from that point. The snapshot is a JSON object that can be serialized and stored in a 
file.</p>
<p>To create a periodic snapshot of the template every time it changes </p>
<pre><code class="language-js"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">template</span><span class="hl-1"> = {</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;count&quot;</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-6">0</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;counter&quot;</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${ $setInterval(function(){$set(&#39;/count&#39;, count+1)}, 10) }&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">   </span><span class="hl-2">&quot;stop&quot;</span><span class="hl-3">:</span><span class="hl-1"> </span><span class="hl-2">&quot;${ count=10?($clearInterval($$.counter);&#39;done&#39;):&#39;not done&#39;  }&quot;</span><br/><span class="hl-1">};</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-9">tp</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">TemplateProcessor</span><span class="hl-1">(</span><span class="hl-3">template</span><span class="hl-1">);</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">tp</span><span class="hl-1">.</span><span class="hl-0">initialize</span><span class="hl-1">();</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-3">fs</span><span class="hl-1">.</span><span class="hl-0">writeFile</span><span class="hl-1">(</span><span class="hl-2">&quot;./myTemplateSnapshot.json&quot;</span><span class="hl-1">, </span><span class="hl-3">tp</span><span class="hl-1">.</span><span class="hl-0">snapshot</span><span class="hl-1">());</span>
</code><button>Copy</button></pre>
<p>To continue template execution from the snapshot, you can either programmatically restore the snapshot</p>
<p>or use 
<code>.restore</code> command in the REPL. </p>
<pre><code class="language-json"><span class="hl-1">&gt; .restore -f example/restoreSnapshot.json --tail </span><span class="hl-2">&quot;/count until $=10&quot;</span><br/><span class="hl-1">Started tailing... Press Ctrl+C to stop.</span><br/><span class="hl-6">10</span>
</code><button>Copy</button></pre>
<a id="md:understanding-plans" class="tsd-anchor"></a><h1><a href="#md:understanding-plans">Understanding Plans</a></h1><p>This information is to explain the planning algorithms to comitters. As a user you do not need to understand how
Stated formulates plans. Before explaining how a plan is made, let&#39;s show the end-to-end flow of how a plan is used 
with an example:</p>
<ol start="0">
<li>A template is shown with a graph tree visualizing the JSON. 
The template contains 3 expressions. For any valid template there is at least one ordering 
of all expressions that produces a correct output. We call such as correct ordering a Plan. 
A Plan is an ordered Array whose elements are JSON Pointers to expressions. To illustrate the importance
of a correct plan, what would happen if the first expression executed was <code>${e.i+100}</code>? The result would 
be garbage/undefined because <code>e.i</code> has not been evaluated.</li>
<li>From the template, a plan is formulated (we will explain how this happens in the following section)</li>
<li>The Plan is executed sequentially producing the final <code>output</code> 
<img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/stated%20metainfo%20algorithms%20-%20Page%201.svg" alt="plan execution"></li>
</ol>
<a id="md:planning" class="tsd-anchor"></a><h1><a href="#md:planning">Planning</a></h1><p>Planning is the process of </p>
<ol>
<li>Analyzing each expression to produce a MetaInfo Node recording facts about the Node such as its dependencies</li>
<li>Organizing MetaInfo into a tree structure mirroring the template JSON</li>
<li>Traversing the tree using a DFS algorithm to produce a single ordering of expression evaluation (a Plan)</li>
</ol>
<a id="md:metainfo-graph" class="tsd-anchor"></a><h2><a href="#md:metainfo-graph">MetaInfo Graph</a></h2><p>A plan is built by traversing a metainfo graph that has these features.</p>
<ul>
<li><strong>labels</strong> - each node is labeled with its JSON POinter</li>
<li><strong>ordinary</strong> nodes - A node such as <code>/a/d</code> is an ordinary node with a value 100</li>
<li><strong>expression</strong> nodes - A node such as <code>/b/e</code> contains a JSONata expression like <code>/${a.c.g}</code></li>
<li><strong>dependency</strong> arrows - Expressions like <code>a.c.g</code> refer to another part of the document, hence have a dependency</li>
<li><strong>non-materialized</strong> nodes - These metadata nodes are created any time a reference creates a dependency on a node 
that does not exist in the JSON template. Such non-materialized nodes come in 2 flavors<ol>
<li>results of expressions (since clearly results of expressions don&#39;t exist in the input template). In the
diagram below,<code>e.i</code> is a local reference to a non-materialized node, from the expression <code>${e.1+100}</code> found in node
<code>/b/f</code>. Hence the absolute JSON Pointer for the non-materialized node is <code>/b/e/i</code>.</li>
<li>information that simply isn&#39;t present yet in the template. An example of this can be a dashboard whose expressions 
depend on a field that is expected to arrive at runtime, for instance <code>query.result</code>. Clearly the result of a query 
is not material in the template.</li>
</ol>
</li>
</ul>
<p>The MetaInfo graph for our example above is:
<img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/stated%20metainfo%20algorithms%20-%20Page%202.svg" alt="Planning"></p>
<a id="md:dfs-tree-traversal" class="tsd-anchor"></a><h2><a href="#md:dfs-tree-traversal">DFS Tree Traversal</a></h2><p>The core algorithm is in the method <code>TemplateProcessor.topologicalSort</code>. This method is passed a metaImnfo node, and
recursively calls itself as it <code>followDependencies</code> and <code>followChildren</code>. A scope is used to detect circular 
dependencies within a given subgraph.</p>
<pre><code class="language-javascript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-0">listDependencies</span><span class="hl-1"> = (</span><span class="hl-3">metaInfo</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">   </span><span class="hl-0">markAsVisited</span><span class="hl-1">(</span><span class="hl-3">metaInfo</span><span class="hl-1">);</span><br/><span class="hl-1">   </span><span class="hl-0">addToScope</span><span class="hl-1">(</span><span class="hl-3">metaInfo</span><span class="hl-1">);</span><br/><br/><span class="hl-1">   </span><span class="hl-0">followDependencies</span><span class="hl-1">(</span><span class="hl-3">metaInfo</span><span class="hl-1">);</span><br/><span class="hl-1">   </span><span class="hl-0">emit</span><span class="hl-1">(</span><span class="hl-3">metaInfo</span><span class="hl-1">);</span><br/><span class="hl-1">   </span><span class="hl-0">followChildren</span><span class="hl-1">(</span><span class="hl-3">metaInfo</span><span class="hl-1">);</span><br/><br/><span class="hl-1">   </span><span class="hl-0">removeFromScope</span><span class="hl-1">(</span><span class="hl-3">metaInfo</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>The only &#39;interesting&#39; thing differentiating this from standard DFS tree-walking and dependency following, is that
there is special treatment for non-materialized nodes. when a non-materialized node is encountered as a result of 
following a dependency, the algorithm travels to the parent of non-materialized node until it finds a node with an
expression. The step labled <code>2</code> in the diagram below illustrates how the non-materialized node is followed up to its
materialized parent expression.</p>
<p>Assuming we call findDeps on node <code>/b/f</code> the diagram below shows the order (1,2,3,4) in which links are traversed. Since
the algorithm is DFS, <em>expression nodes</em> are added in reverse traversal order: <code>[&#39;/a/c/g/i&#39;, &#39;/b/e&#39;, &#39;/b/f&#39;]</code></p>
<p><img src="https://raw.githubusercontent.com/geoffhendrey/jsonataplay/main/stated%20metainfo%20algorithms%20-%20Page%203.svg" alt="Traversal"></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><ul><li><ul><li><a href="#md:stated"><span>Stated</span></a></li><li><a href="#md:licensing-and-documentation"><span>Licensing and documentation</span></a></li><li><a href="#md:api-docs"><span>API docs</span></a></li><li><a href="#md:testing"><span>Testing</span></a></li><li><a href="#md:intro"><span>Intro</span></a></li><li><a href="#md:motivation"><span>Motivation</span></a></li><li><a href="#md:getting-started"><span>Getting <wbr/>Started</span></a></li><li><ul><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:running"><span>Running</span></a></li><li><ul><li><a href="#md:repl-mode"><span>REPL <wbr/>Mode</span></a></li><li><a href="#md:oneshot-mode"><span>Oneshot mode</span></a></li></ul></li></ul></li><li><a href="#md:stated-js-lib"><span>stated-<wbr/>js lib</span></a></li><li><ul><li><a href="#md:api-documentation"><span>API documentation</span></a></li><li><a href="#md:basic-usage"><span>Basic usage</span></a></li><li><ul><li><a href="#md:stated-js-packagejson-exports"><span>Stated-<wbr/>js package.json exports</span></a></li><li><ul><li><a href="#md:nodejs-based-projects"><span>Node.js based projects</span></a></li></ul></li></ul></li></ul></li><li><a href="#md:repl-commands"><span>REPL <wbr/>Commands</span></a></li><li><ul><li><a href="#md:open"><span>.open</span></a></li><li><a href="#md:all-commands"><span>All commands</span></a></li><li><a href="#md:out"><span>.out</span></a></li><li><a href="#md:color"><span>.color</span></a></li><li><a href="#md:log"><span>.log</span></a></li><li><a href="#md:set"><span>.set</span></a></li><li><a href="#md:repl-command-arguments"><span>REPL command arguments</span></a></li><li><ul><li><a href="#md:--options"><span>--options</span></a></li><li><ul><li><a href="#md:strict"><span>strict</span></a></li></ul></li><li><a href="#md:--xf"><span>--xf</span></a></li><li><a href="#md:--ctx"><span>--ctx</span></a></li></ul></li></ul></li><li><a href="#md:language-amp-syntax"><span>Language &amp; <wbr/>Syntax</span></a></li><li><ul><li><a href="#md:expressions-and-variables"><span>Expressions and <wbr/>Variables</span></a></li><li><a href="#md:dollars-moustache"><span>Dollars-<wbr/>Moustache</span></a></li><li><a href="#md:dollars-variables"><span>Dollars-<wbr/>Variables</span></a></li><li><a href="#md:temporary-expressions"><span>Temporary <wbr/>Expressions</span></a></li><li><a href="#md:references"><span>References</span></a></li><li><a href="#md:expression-scope"><span>Expression <wbr/>Scope</span></a></li><li><a href="#md:rerooting-expressions"><span>Rerooting <wbr/>Expressions</span></a></li><li><a href="#md:tags"><span>Tags</span></a></li><li><a href="#md:blocked-properties-with-"><span>Blocked <wbr/>Properties with </span></a></li></ul></li><li><a href="#md:generative-templates"><span>Generative <wbr/>Templates</span></a></li><li><a href="#md:reactive-behavior"><span>Reactive <wbr/>Behavior</span></a></li><li><ul><li><a href="#md:svg-command"><span>SVG command</span></a></li><li><a href="#md:yaml"><span>YAML</span></a></li><li><a href="#md:setting-values-in-the-stated-repl"><span>Setting <wbr/>Values in the stated REPL</span></a></li><li><a href="#md:expression-scope-1"><span>Expression <wbr/>Scope</span></a></li><li><a href="#md:rerooting-expressions-1"><span>Rerooting <wbr/>Expressions</span></a></li><li><a href="#md:dag"><span>DAG</span></a></li><li><a href="#md:visualizing-the-plan-with-svg-command"><span>visualizing the plan with .svg command</span></a></li></ul></li><li><a href="#md:concurrency"><span>Concurrency</span></a></li><li><ul><li><a href="#md:serialized-mutations"><span>Serialized <wbr/>Mutations</span></a></li><li><a href="#md:atomic-state-updates"><span>Atomic <wbr/>State <wbr/>Updates</span></a></li><li><a href="#md:multi-version-concurrency-control-mvcc-and--forked"><span>Multi <wbr/>Version <wbr/>Concurrency <wbr/>Control (MVCC) and  $forked</span></a></li></ul></li><li><a href="#md:yaml-1"><span>YAML</span></a></li><li><a href="#md:complex-data-processing"><span>Complex <wbr/>Data <wbr/>Processing</span></a></li><li><a href="#md:functions"><span>Functions</span></a></li><li><ul><li><a href="#md:jsonata-built-in"><span>JSONata built-<wbr/>in</span></a></li><li><a href="#md:stated-functions"><span>Stated functions</span></a></li><li><ul><li><a href="#md:env"><span>$env</span></a></li><li><a href="#md:generate"><span>$generate</span></a></li><li><a href="#md:accumulate-default-and-self"><span>accumulate, default, and self</span></a></li><li><a href="#md:settimeout"><span>$set<wbr/>Timeout</span></a></li><li><a href="#md:setinterval"><span>$set<wbr/>Interval</span></a></li><li><a href="#md:fetch"><span>$fetch</span></a></li><li><a href="#md:import"><span>$import</span></a></li><li><ul><li><a href="#md:importing-bits-of-other-templates"><span>Importing bits of other templates</span></a></li><li><a href="#md:setting-up-local-imports-with---importpath"><span>Setting up local imports with --import<wbr/>Path</span></a></li><li><a href="#md:import-javascript-es-modules"><span>Import <wbr/>Javascript ES modules</span></a></li><li><a href="#md:the-__init-sidecar-function"><span>The __init sidecar function</span></a></li></ul></li><li><a href="#md:open-1"><span>$open</span></a></li><li><a href="#md:set-1"><span>$set</span></a></li><li><a href="#md:debounce"><span>$debounce</span></a></li><li><a href="#md:defer"><span>$defer</span></a></li><li><a href="#md:ratelimit"><span>$rate<wbr/>Limit</span></a></li></ul></li><li><a href="#md:custom-functions"><span>Custom <wbr/>Functions</span></a></li><li><ul><li><a href="#md:simple-custom-function-example"><span>Simple <wbr/>Custom <wbr/>Function <wbr/>Example</span></a></li><li><a href="#md:more-complex-function-example"><span>More <wbr/>Complex <wbr/>Function <wbr/>Example</span></a></li></ul></li></ul></li><li><a href="#md:error-handling"><span>Error <wbr/>Handling</span></a></li><li><ul><li><a href="#md:the-error-object"><span>The error object</span></a></li><li><a href="#md:error-reporting"><span>Error <wbr/>Reporting</span></a></li><li><a href="#md:errorreport-function"><span>$error<wbr/>Report function</span></a></li></ul></li><li><a href="#md:templateprocessor-snapshots"><span>Template<wbr/>Processor <wbr/>Snapshots</span></a></li><li><a href="#md:understanding-plans"><span>Understanding <wbr/>Plans</span></a></li><li><a href="#md:planning"><span>Planning</span></a></li><li><ul><li><a href="#md:metainfo-graph"><span>Meta<wbr/>Info <wbr/>Graph</span></a></li><li><a href="#md:dfs-tree-traversal"><span>DFS <wbr/>Tree <wbr/>Traversal</span></a></li></ul></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-1"></use></svg><span>stated-js</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li><a href="modules/CliCore.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>CliCore</a></li><li><a href="modules/CliCoreBase.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>CliCoreBase</a></li><li><a href="modules/ConsoleLogger.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>ConsoleLogger</a></li><li><a href="modules/DataFlow.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>DataFlow</a></li><li><a href="modules/DependencyFinder.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>DependencyFinder</a></li><li><a href="modules/ExecutionStatus.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>ExecutionStatus</a></li><li><a href="modules/FancyLogger.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>FancyLogger</a></li><li><a href="modules/JsonPointer.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>JsonPointer</a></li><li><a href="modules/Lifecycle.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>Lifecycle</a></li><li><a href="modules/LifecycleManager.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>LifecycleManager</a></li><li><a href="modules/MetaInfoProducer.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>MetaInfoProducer</a></li><li><a href="modules/ParallelExecutionPlan.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>ParallelExecutionPlan</a></li><li><a href="modules/ParallelExecutionPlanDefault.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>ParallelExecutionPlanDefault</a></li><li><a href="modules/ParallelPlanner.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>ParallelPlanner</a></li><li><a href="modules/Planner.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>Planner</a></li><li><a href="modules/SerialPlanner.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>SerialPlanner</a></li><li><a href="modules/StatedREPL.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>StatedREPL</a></li><li><a href="modules/TemplateProcessor.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>TemplateProcessor</a></li><li><a href="modules/TestUtils.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>TestUtils</a></li><li><a href="modules/TimerManager.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>TimerManager</a></li><li><a href="modules/TraversalState.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-2"></use></svg>TraversalState</a></li><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><svg style="display: none"><g id="icon-1"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-module)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z" fill="var(--color-text)"></path></g><g id="icon-2"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-module)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z" fill="var(--color-text)"></path></g><g id="icon-4"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-namespace)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z" fill="var(--color-text)"></path></g><g id="icon-8"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-enum)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.45 16V7.24H14.49V8.224H10.518V10.936H14.07V11.908H10.518V15.016H14.49V16H9.45Z" fill="var(--color-text)"></path></g><g id="icon-16"><rect fill="var(--color-icon-background)" stroke="#FF984D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z" fill="var(--color-text)"></path></g><g id="icon-32"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-variable)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M11.106 16L8.85 7.24H9.966L11.454 13.192C11.558 13.608 11.646 13.996 11.718 14.356C11.79 14.708 11.842 14.976 11.874 15.16C11.906 14.976 11.954 14.708 12.018 14.356C12.09 13.996 12.178 13.608 12.282 13.192L13.758 7.24H14.85L12.582 16H11.106Z" fill="var(--color-text)"></path></g><g id="icon-64"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)"></path></g><g id="icon-128"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-class)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z" fill="var(--color-text)"></path></g><g id="icon-256"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-interface)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.51 16V15.016H11.298V8.224H9.51V7.24H14.19V8.224H12.402V15.016H14.19V16H9.51Z" fill="var(--color-text)"></path></g><g id="icon-512"><rect fill="var(--color-icon-background)" stroke="#4D7FFF" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z" fill="var(--color-text)"></path></g><g id="icon-1024"><rect fill="var(--color-icon-background)" stroke="#FF984D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z" fill="var(--color-text)"></path></g><g id="icon-2048"><rect fill="var(--color-icon-background)" stroke="#FF4DB8" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M9.162 16V7.24H10.578L11.514 10.072C11.602 10.328 11.674 10.584 11.73 10.84C11.794 11.088 11.842 11.28 11.874 11.416C11.906 11.28 11.954 11.088 12.018 10.84C12.082 10.584 12.154 10.324 12.234 10.06L13.122 7.24H14.538V16H13.482V12.82C13.482 12.468 13.49 12.068 13.506 11.62C13.53 11.172 13.558 10.716 13.59 10.252C13.622 9.78 13.654 9.332 13.686 8.908C13.726 8.476 13.762 8.1 13.794 7.78L12.366 12.16H11.334L9.894 7.78C9.934 8.092 9.97 8.456 10.002 8.872C10.042 9.28 10.078 9.716 10.11 10.18C10.142 10.636 10.166 11.092 10.182 11.548C10.206 12.004 10.218 12.428 10.218 12.82V16H9.162Z" fill="var(--color-text)"></path></g><g id="icon-4096"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)"></path></g><g id="icon-8192"><rect fill="var(--color-icon-background)" stroke="#FF984D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z" fill="var(--color-text)"></path></g><g id="icon-16384"><rect fill="var(--color-icon-background)" stroke="#4D7FFF" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M11.898 16.1201C11.098 16.1201 10.466 15.8961 10.002 15.4481C9.53803 15.0001 9.30603 14.3841 9.30603 13.6001V9.64012C9.30603 8.85612 9.53803 8.24012 10.002 7.79212C10.466 7.34412 11.098 7.12012 11.898 7.12012C12.682 7.12012 13.306 7.34812 13.77 7.80412C14.234 8.25212 14.466 8.86412 14.466 9.64012H13.386C13.386 9.14412 13.254 8.76412 12.99 8.50012C12.734 8.22812 12.37 8.09212 11.898 8.09212C11.426 8.09212 11.054 8.22412 10.782 8.48812C10.518 8.75212 10.386 9.13212 10.386 9.62812V13.6001C10.386 14.0961 10.518 14.4801 10.782 14.7521C11.054 15.0161 11.426 15.1481 11.898 15.1481C12.37 15.1481 12.734 15.0161 12.99 14.7521C13.254 14.4801 13.386 14.0961 13.386 13.6001H14.466C14.466 14.3761 14.234 14.9921 13.77 15.4481C13.306 15.8961 12.682 16.1201 11.898 16.1201Z" fill="var(--color-text)"></path></g><g id="icon-32768"><rect fill="var(--color-icon-background)" stroke="#FF984D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M9.354 16V7.24H12.174C12.99 7.24 13.638 7.476 14.118 7.948C14.606 8.412 14.85 9.036 14.85 9.82C14.85 10.604 14.606 11.232 14.118 11.704C13.638 12.168 12.99 12.4 12.174 12.4H10.434V16H9.354ZM10.434 11.428H12.174C12.646 11.428 13.022 11.284 13.302 10.996C13.59 10.7 13.734 10.308 13.734 9.82C13.734 9.324 13.59 8.932 13.302 8.644C13.022 8.356 12.646 8.212 12.174 8.212H10.434V11.428Z" fill="var(--color-text)"></path></g><g id="icon-65536"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-type-alias)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)"></path></g><g id="icon-131072"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-type-alias)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)"></path></g><g id="icon-262144"><rect fill="var(--color-icon-background)" stroke="#FF4D4D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z" fill="var(--color-text)"></path></g><g id="icon-524288"><rect fill="var(--color-icon-background)" stroke="#FF4D4D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z" fill="var(--color-text)"></path></g><g id="icon-1048576"><rect fill="var(--color-icon-background)" stroke="#FF4D4D" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M8.85 16L11.13 7.24H12.582L14.85 16H13.758L13.182 13.672H10.53L9.954 16H8.85ZM10.746 12.76H12.954L12.282 10.06C12.154 9.548 12.054 9.12 11.982 8.776C11.91 8.432 11.866 8.208 11.85 8.104C11.834 8.208 11.79 8.432 11.718 8.776C11.646 9.12 11.546 9.544 11.418 10.048L10.746 12.76Z" fill="var(--color-text)"></path></g><g id="icon-2097152"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-type-alias)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M11.31 16V8.224H8.91V7.24H14.79V8.224H12.39V16H11.31Z" fill="var(--color-text)"></path></g><g id="icon-4194304"><rect fill="var(--color-icon-background)" stroke="#FF4D82" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="12"></rect><path d="M10.354 17V8.24H13.066C13.586 8.24 14.042 8.348 14.434 8.564C14.826 8.772 15.13 9.064 15.346 9.44C15.562 9.816 15.67 10.256 15.67 10.76C15.67 11.352 15.514 11.86 15.202 12.284C14.898 12.708 14.482 13 13.954 13.16L15.79 17H14.518L12.838 13.28H11.434V17H10.354ZM11.434 12.308H13.066C13.514 12.308 13.874 12.168 14.146 11.888C14.418 11.6 14.554 11.224 14.554 10.76C14.554 10.288 14.418 9.912 14.146 9.632C13.874 9.352 13.514 9.212 13.066 9.212H11.434V12.308Z" fill="var(--color-text)"></path></g><g id="icon-chevronDown"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></g><g id="icon-chevronSmall"><path d="M1.5 5.50969L8 11.6609L14.5 5.50969L12.5466 3.66086L8 7.96494L3.45341 3.66086L1.5 5.50969Z" fill="var(--color-text)"></path></g><g id="icon-menu"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></g><g id="icon-search"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></g><g id="icon-anchor"><g stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></g></g></svg></body></html>